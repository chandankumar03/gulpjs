/**
 * My Account script
 */
"use strict";

var PF = PF || {};

// force utilities library
if (typeof PF.UTILITIES === 'undefined') {
    (function () {
        window.root_url = (typeof root_url === 'undefined') ? 'http://' + window.location.hostname : root_url;
        window.secure_url = (typeof secure_url === 'undefined') ? 'https://' + window.location.hostname : secure_url;
        var _node = document.createElement('script');
        _node.type = 'text/javascript';
        _node.src = ((window.location.protocol === 'http:') ? root_url : secure_url) + '/js/utilities.js';
        document.getElementsByTagName('head')[ 0 ].appendChild(_node);
    })();
}

if (typeof PF.MYACCOUNT === 'undefined') {
    (function (z, $) {
        var utils = z.UTILITIES;
        var o = {
            d: $(document),
            w: $(window),
            processError: 'An error has occurred. Please refresh the page and try again.',
            formErrorHtml: '<div class="error-text">{{ERROR}}</div>',
            lastEnteredPin: '',
            formErrorMsg: {                
                file_error: {
                    file : 'Please select a file',
                    file_extension : 'Please select a valid file',
                    file_size : 'Max 5Mb allowed!',
                    file_noselect_flag: true,
                    file_size_error: true
                }
            },
            dashboard: {
                click: { '.tab-inner-content a.track-item-link': ['PF.MYACCOUNT.trackOrder',"#page"],
                    '.return-order-submit': ['PF.MYACCOUNT.submitReturnFrom', '#page'],
                    '.add-more-file': ['PF.MYACCOUNT.callUploadFile', '#page'],
                    '.remove-file': ['PF.MYACCOUNT.removeUploadedFile', '#page'],
                    'return-popup-show':['PF.MYACCOUNT.resetReturnItemPopup', '#page'],
                    '.fdbck-wrprmyacc.ratable .feedback-rate input,.myacc-fdbcksbmt-btn':'PF.MYACCOUNT.save_rating',                    
                    '.myacc-fdbcksbmt-btnwrpr .myacc-fdbckskip-btn':'PF.MYACCOUNT.slideHtml'
                },
                change:{
                    '.rpImage': ['PF.MYACCOUNT.uploadFileOnSelect', '#page'],
                },
                mouseenter:{'.myacnt-shrfdbck-container':'PF.MYACCOUNT.openRatingHtml'},
                mouseleave:{'.myacnt-shrfdbck-container':'PF.MYACCOUNT.closeRatingHtml'}
            },
            orders: {
                click: {
                    '.tab-inner-content a.track-item-link': ['PF.MYACCOUNT.trackOrder','#page'],
                    '.return-order-submit': ['PF.MYACCOUNT.submitReturnFrom', '#page'],
                    '.remove-file': ['PF.MYACCOUNT.removeUploadedFile', '#page'],
                    '.add-more-file': ['PF.MYACCOUNT.callUploadFile', '#page'],
                    'return-popup-show':['PF.MYACCOUNT.resetReturnItemPopup', '#page'],
                    '#clear_order_search_box': 'PF.MYACCOUNT.myOrdersClearSearchBox',
                    '.fdbck-wrprmyacc.ratable .feedback-rate input,.myacc-fdbcksbmt-btn':'PF.MYACCOUNT.save_rating',                    
                    '.myacc-fdbcksbmt-btnwrpr .myacc-fdbckskip-btn':'PF.MYACCOUNT.slideHtml',
                },
                change: {'#maOrderselect2': ['PF.MYACCOUNT.myOrdersMonthFilter', '#page'],
                    '.rpImage': ['PF.MYACCOUNT.uploadFileOnSelect', '#page'],
                        
                },                
                keyup: {'#order_no': ['PF.MYACCOUNT.myOrdersSearchByOrderNo','#page']},
                mouseenter:{'.myacnt-shrfdbck-container':'PF.MYACCOUNT.openRatingHtml'},
                mouseleave:{'.myacnt-shrfdbck-container':'PF.MYACCOUNT.closeRatingHtml'}
            },
            wishlist: {
                click: {
                    '#wishlistTab a.remove-wishlist-item': ['PF.MYACCOUNT.removeFromWishlist', '#page'],
                    '#wishlistTab #popup_login_form':['PF.MYACCOUNT.submitWishlistComment', '#page']
                }
            },
            account: {
                click:{
                    '.my-profile-container .editBtn': ['PF.MYACCOUNT.editInputBoxes', '#page'],
                    '#save-basic-profile': ['PF.MYACCOUNT.updateProfile', '#page'],
                    '#saveChangePassword': ['PF.MYACCOUNT.updatePassword', '#page']
                },
                change:{
                    "input[name='gender']": ['PF.MYACCOUNT.verifyGender', '#page']
                }
            },
            addressBook: {
                click: {
                    '#maEnterYourNewAdd #saveAddress': ['PF.MYACCOUNT.saveAddress', '#page'],
                    '.address_delete': ['PF.MYACCOUNT.deleteAddress', '#page'],
                    '.address_edit,.add-new-address': ['PF.MYACCOUNT.editAddressModal', '#page'],
                },
                change: {
                    '#maEnterYourNewAdd .ck-state-select': ['PF.MYACCOUNT.verifyState', '#page'],
                    '#maEnterYourNewAdd .ck-country-select': ['PF.MYACCOUNT.verifyCountry', '#page'],
                    '.ma-address-tab input.radio_select': ['PF.MYACCOUNT.setDefaultAddress', '#page'],
                },
                submit: {                    
                },
                keyup: {
                    '#postcode': ['PF.MYACCOUNT.pinAutoComplete', '#page']
                },
            },
            returnItem: {
                click: {
                      '.return-order-submit': ['PF.MYACCOUNT.submitReturnFrom', '#page'],
                      '.remove-file': ['PF.MYACCOUNT.removeUploadedFile', '#page'],
                      '.add-more-file': ['PF.MYACCOUNT.callUploadFile', '#page'],
                      'return-popup-show':['PF.MYACCOUNT.resetReturnItemPopup', '#page'],
                      '.view-more-return-orders': ['PF.MYACCOUNT.loadOrders', '#page'],
                },
                change: {
                     '.rpImage': ['PF.MYACCOUNT.uploadFileOnSelect', '#page'],
                },  
            },
            returnItemLogin: {
                click: {
                    // '.cs-return-tabs ul li' : ['PF.MYACCOUNT.switchTab', '#page']
                }
            },
            dedicatedNotification:{
              click:{
                  '.feedback-rate input' : ['PF.MYACCOUNT.chooseRating', '#page'],
              },
              change:{
                  '.rating-reason': ['PF.MYACCOUNT.changeFeedbackReason', '#page'],
              }
            },
            init: function () {                
                o.oneTimeLoad=true;
                o.addressBookLoad=false;
                o.maxFilesToUpload = 3;
                if($(".rating-reason").length>0){
                    $(".rating-reason").select2({ minimumResultsForSearch: Infinity });
                }
                
                $("#maOrderselect2").select2({
                    minimumResultsForSearch: -1
                });
                $("#maInitiateReturnselect2").select2({
                    minimumResultsForSearch: -1
                });
                $("#selectCountry").select2();
                $("#selectState").select2();

                $("#selectCountry2").select2();
                $("#selectState2").select2();
                
                if (window.location.pathname.indexOf('customer/dashboard') !== -1) {
                    utils.listen(o.dashboard);
                } else if (window.location.pathname.indexOf('customer/myorders') !== -1) {
                    utils.listen(o.orders);
                    var currentPeriod = parseInt(utils.getParameterByName('period'));
                    if (!isNaN(currentPeriod)) {
                        $('#viewOrderTab div.month-filter-wrap select option').filter(function () {
                            return parseInt($(this).val()) === currentPeriod;
                        }).prop('selected', true);
                    }
                } else if (window.location.pathname.indexOf('customer/wishlist') !== -1) {
                    utils.listen(o.wishlist);                    
                } else if (window.location.pathname.indexOf('customer/account') !== -1) {
                    utils.listen(o.account);
                } else if (window.location.pathname.indexOf('customer/address_book') !== -1) {
                    utils.listen(o.addressBook);
                } else if (window.location.pathname.indexOf('customer/returnitem') !== -1) {
                    utils.listen(o.returnItem);
                } else if (window.location.pathname.indexOf('customer/initiatereturnlogin') !== -1) {
                    utils.listen(o.returnItemLogin);
                }
                else if (window.location.pathname.indexOf('customer/dedicatedNotification') !== -1) {
                    utils.listen(o.dedicatedNotification);
                }
                
                if(!XMLHttpRequest.prototype.sendAsBinary){ 
                        XMLHttpRequest.prototype.sendAsBinary = function(datastr) {  
                                function byteValue(x) {  
                                        return x.charCodeAt(0) & 0xff;  
                                }  
                                var ords = Array.prototype.map.call(datastr, byteValue);  
                                var ui8a = new Uint8Array(ords);  
                                try{
                                        this.send(ui8a);
                                }catch(e){
                                        this.send(ui8a.buffer);
                                }  
                        };  
                }

            },
            pinAutoComplete: function () {
                var pin = parseInt($(this).val());
                if (pin.toString().length === 6 && pin > 0 && o.lastEnteredPin !== pin) {
                    o.lastEnteredPin = pin;
                    var country = $("#selectCountry").val();
                    var _url = secure_url + '/config_pincode/getpindata';

                    if (country === 'IN') {
                        utils.makeRequest(
                            _url,
                            'POST',
                            {pincode: pin},
                            o.pinAutoCompleteResponse,
                            PF.ERROR.raiseError,
                            '',
                            {},
                            {dataType: 'json'}
                        );
                    }
                }
            },
            pinAutoCompleteResponse : function ( d ) {
                if( d ) {
                    d = $.parseJSON( d );
                    if( typeof( d.city ) != 'undefined' && ( d.city.length > 1 ) ) {
                        $('#city').val(d.city).parent().addClass('input-filled');
                    } else {
                        $('#city').val( '' ).parent().removeClass('input-filled');
                    }

                    if( typeof( d.state ) != 'undefined' && ( d.state.length > 1 ) ) {
                        // add state only if it's valid
                        if( $( '#selectState option[value="' + d.state + '"]' ).length > 0 ) {
                            $("#selectState").val(d.state).select2().removeClass('disabled');
                        } else {
                            $( '#selectState' ).select2( 'val', $( '#region option:first' ).val() );
                        }
                    } else {
                        $( '#selectState' ).select2( 'val', $( '#region option:first' ).val() );
                    }

//commented this code for removing autocomplete since no design provided in redesign ( changes added by Nishigandha N)
//                    if (d.locality) {
//                        var locality = $.parseJSON(d.locality);
//
//                        if (Object.keys(d.locality).length > 0) {
//                            $("#area").autocomplete({source: locality, appendTo: "#form-area"});
//                            //for perfect autocomplete, it will search string that starts with typed character
//                            $.ui.autocomplete.filter = function (array, term) {
//                                var matcher = new RegExp("^" + $.ui.autocomplete.escapeRegex(term), "i");
//                                return $.grep(array, function (value) {
//                                    return matcher.test(value.label || value.value || value);
//                                });
//                            };
//                        }
//                    }
                } else {
                    $("#form-area .ui-autocomplete,#form-area .ui-helper-hidden-accessible").remove();
                    $('#city').val('').removeClass('input-filled');
                    $("#selectState").val('').select2().removeClass('disabled');
                }
            },
            verifyState:function(){
                var frmId = $('.ck-state-select').closest('form').attr('id');
                if(o.addressBookLoad === true) {
                    return true;
                }
                if($(".ck-state-select").parent("div").css("display")=="block"){
                    var stateIp = $("#" + frmId).find('.ck-state-select');
                    var stateIpVal = stateIp.val();
                    if (stateIpVal === '') {
                        stateIp.addClass('error-inpt').parent('div').addClass('frm-error-wrap').removeClass('frm-success-wrap');
                    }
                    else {
                        stateIp.removeClass('error-inpt').parent('div').removeClass('frm-error-wrap').addClass('frm-success-wrap');
                    }
                }
                else{
                    var stateIp = $("#" + frmId).find('.ck-state-input');
                    var stateIpVal = stateIp.val();
                    if (stateIpVal === '') {
                        stateIp.parent('div').addClass('frm-error-wrap').removeClass('frm-success-wrap');
                    }
                    else {
                        stateIp.parent('div').removeClass('frm-error-wrap').addClass('frm-success-wrap');
                    }
                }
            },
            saveAddress: function () {
                var $this = $("#maEnterYourNewAdd");
                var error = false;                
                var formId = 'maEnterYourNewAdd';
                
                var postcode = parseInt($("#maEnterYourNewAdd #postcode").val());
                var city = $("#maEnterYourNewAdd #city").val().trim();
                var country = $("#maEnterYourNewAdd #selectCountry").val().trim();
                var state = "";
                
                if($(".ck-state-select").parent("div").css("display")=="block"){
                    state = $.trim($(".ck-state-select").val());
                }
                else{
                    state = $.trim($(".ck-state-input").val());
                }
                
                if (country === 'IN' || country === '') {
                    
                    var pincodeval = $("#postcode").val().trim();
                    var pincodelen = pincodeval.length;
                    $("#postcode").parent("div").removeClass("frm-error-wrap").removeClass("frm-success-wrap");
                    if(pincodeval==""){
                        $("#postcode").parent("div").addClass("frm-error-wrap").removeClass("frm-success-wrap");
                        error = true;
                    }
                    else if(pincodelen!=6){                        
                        $("#postcode").parent("div").removeClass("frm-success-wrap1").addClass("frm-error-wrap");
                        error = true;
                    }
                    else if(isNaN(pincodeval)){
                        $("#postcode").parent("div").addClass("frm-error-wrap").removeClass("frm-success-wrap");
                        error = true;
                    }
                    else{
                        $("#postcode").parent("div").removeClass("frm-error-wrap").addClass("frm-success-wrap");
                        
                    }
                }
                if(error==false){
                    error = PF.HEADER.validateForm("",formId);
                }
                var alphaOnly = /^[A-Za-z ]+$/;

                if (error==false && (state === '' || !(state.match(alphaOnly)))) {
                    //o.verifyState();    
                    if($(".form-select").css("display")=="block"){
                        $(".ck-state-input").parent("div").addClass("frm-error-wrap").removeClass("frm-success-wrap")
                    }
                    else{
                        $(".form-state-select").parent("div").addClass("frm-error-wrap").removeClass("frm-success-wrap")
                    }
                    error = true;
                }
                else{
                    if($(".form-select").parent("div").css("display")=="block"){
                        $(".ck-state-input").parent("div").removeClass("frm-error-wrap").removeClass("frm-success-wrap")
                    }
                    else
                    {
                        $(".form-state-select").parent("div").removeClass("frm-error-wrap").removeClass("frm-success-wrap")
                    }
                }
                
                if (!error) {                    
                    var _url = secure_url + "/address/addEditAddress/";
                    var _data = $this.serialize();
                    $.ajax
                    ({ 
                        url: _url,
                        data:_data, 
                        type: "POST",
                        beforeSend : function(){
                            $("#saveAddress").attr('disabled', 'disabled').addClass('btn_loader');
                        },
                        success: function(response)
                        {       
                            if(response ==  '"invalid"'){
                                alert(o.processError);
                            }else{
                                var _path = secure_url + '/customer/address_book';
                                window.location = _path;
                            }
                        },
                        error:function(){
                            alert("Some error occured");
                        },
                        complete:function(msg)
                        {
                            $("#saveAddress").removeAttr("disabled").removeClass('btn_loader');
                        }
                    });                   
                }
                return false;
            },
            verifyCountry:function(){
                var frmId = $('.ck-country-select').closest('form').attr('id');
                var countryIp = $("#" + frmId).find('.ck-country-select');
                var countryIpVal = countryIp.val();
                
                $("#" + frmId).find('.ck-state-input').val("");
                $("#" + frmId).find('.ck-state-select').val("").change();
                
                
                if(countryIpVal!='IN'){
                    $(".ck-state-input").parent("div").css("display","block");                    
                    $(".ck-state-select").parent("div").css("display","none").attr("disabled");
                    $(".ck-state-input").removeAttr("disabled");
                    $(".ck-state-select").attr("disabled","true");
                }
                else{
                    $(".ck-state-input").parent("div").css("display","none").attr("disabled");
                    $(".ck-state-select").parent("div").css("display","block").removeAttr("disabled")
                    $(".ck-state-input").attr("disabled","true");
                    $(".ck-state-select").removeAttr("disabled");
                    
                }
                
                if (countryIpVal === '') {
                    countryIp.addClass('error-inpt').parent('div').addClass('frm-error-wrap').removeClass('frm-success-wrap');
                } else {                    
                    countryIp.removeClass('error-inpt').parent('div').removeClass('frm-error-wrap').addClass('frm-success-wrap');
                    
                }
                
            },
            setDefaultAddress: function (e) {
                $('input[name=address_select]').prop('checked', false);
                var _url = secure_url + '/address/makeDefault/' + this.value;
                utils.makeRequest(
                        _url,
                        'GET',
                        {},
                        function (d, e) {
                            $('#addressBook_' + e.id).prop('checked', true);
                        },
                        PF.ERROR.raiseError,
                        '',
                        {
                            id: this.value
                        }
                );
            },
            deleteAddress: function (e) {
                if (!confirm('Do you want to delete this address?')){
                    return;
                }
                else{
                    var id = $(this).attr('value');
                    var _url = secure_url + '/address/deleteAddress';
                    utils.makeRequest(
                            _url,
                            'POST',
                            {
                                address_id: id
                            },
                            function (d, e) {
                                $("#address-" + e.id).remove();
                                $('label.ship-address-main').each(function(i) {
                                    var j = i+1;
                                    $(this).find('div:first').html('Address ' + j);
                                });
                                var addressCnt = $('.ship-address-row').size();
                                if (addressCnt === 0) {
                                    $('#editAddressBlock').addClass('no-address');
                                }
                                if (addressCnt < 10) {
                                    $('#editAddressBlock').show();
                                }
                            },
                            PF.ERROR.raiseError,
                            '',
                            {
                                id: id
                            }
                    );
                }
            },
            editAddressModal:function(e){
                var _modal = $(this).attr('modal-val');    
                $(this).attr('data-modal',_modal);
                $('#my-addr-book-newaddr-popup').attr('data-modalname', _modal).find('.pf-semi-bold-text').html('Edit Address');
                var id = $(this).attr('data-id');
                $("#update_id").val(id);
                
                $("#maEnterYourNewAdd #name").val($.trim($("#fname-" + id).val()));
                $("#maEnterYourNewAdd #name2").val($.trim($("#lname-" + id).val()));
                $("#maEnterYourNewAdd #mobile").val($.trim($("#mobile-" + id).val()));
                $("#maEnterYourNewAdd #street").val($.trim($("#street-" + id).val()));
                $("#maEnterYourNewAdd #area").val($.trim($("#street1-" + id).val()));
                $("#maEnterYourNewAdd #landmark").val($.trim($("#landmark-" + id).val()));
                $("#maEnterYourNewAdd #city").val($.trim($("#city-" + id).val()));
                
                var state = $.trim($("#state-" + id).val())?$.trim($("#state-" + id).val()):'';
                var countryName =($("#countryid-" + id).val() != '' && $("#countryid-" + id).val()!='IN' )? $("#countryid-" + id).val():'IN';
                
                if($(this).hasClass('address_edit') === false){
                    $('#my-addr-book-newaddr-popup').find('h5').html('Enter a New Address');
                    o.addressBookLoad=true;
                    $("#selectCountry").val('IN').change();
                    
                }
                
                if($(this).hasClass('address_edit')){
                    $("#selectCountry").val(countryName).change();               
                }
                
                
                $("#form-contry").removeClass("frm-error-wrap").removeClass("frm-success-wrap");
                o.addressBookLoad=false;
                if ($.trim($("#countryid-" + id).val()) === "IN" || $.trim($("#countryid-" + id).val()) === "") {
                   $("#form-state-select").css("display","block");
                   $("#form-state").css("display","none");
                   
                   if(_modal!="add-address"){
                        $("#maEnterYourNewAdd #selectState").val(state).change();
                        $("#form-state-select").removeClass("frm-error-wrap").removeClass("frm-success-wrap");
                    }
                   $("#selectState").removeAttr('disabled');
                   $("#state_input").val(state).attr("disabled","disabled");
                }
                else{
                    if(_modal!="add-address"){
                        $("#form-state").removeClass("frm-error-wrap").removeClass("frm-success-wrap");
                    }
                    
                    
                    $("#selectState").attr("disabled","disabled");
                    $("#state_input").val(state).removeAttr('disabled');
                   $("#form-state-select").css("display","none");
                   $("#form-state").css("display","block"); 
                }
                
                $("#maEnterYourNewAdd #postcode").val($.trim($("#postcode-" + id).val()));
                $("#maEnterYourNewAdd #country").val($.trim($("#countryid-" + id).val())).select2();
                $('#popup_overlay').fadeIn(function () {
                    $('[data-modalname=' + _modal + ']').fadeIn();
                    $('body').addClass('active');
                });
                
                $(document).on('click', '.popup-close,.popup_overlay', function (e) {
                    $('[data-modalname=' + _modal + ']').fadeOut(function () {
                        $('#my-addr-book-newaddr-popup').attr('data-modalname', 'add-address').find('h5').html('Enter a New Address');
                        $('#popup_overlay').fadeOut();
                        $('body').removeClass('active');
                    });
                    e.preventDefault();
                });
                $(document).keyup(function (e) {
                    if (e.keyCode === 27) {
                        $('[data-modalname=' + _modal + ']').fadeOut(function () {                            
                            $('#my-addr-book-newaddr-popup').attr('data-modalname', 'add-address').find('h5').html('Enter a New Address');
                            $('#popup_overlay').fadeOut();
                            $('body').removeClass('active');
                        });
                    }
                });
            },
            editInputBoxes:function(e){
                $(this).hide().siblings(".inpt").focus().removeClass('disabled');
                $(this).parents('.edit-info-sec').find('.pf-btn').removeClass("disabled").addClass("pf-hover-primary-color");
            },
            updateProfile:function(e){
                var error = true; 
                var formId = 'maEditAddress';
                error= PF.HEADER.validateForm("",formId);
                if(error === false){
                    $("#"+formId).submit();
                }
            },            
            verifyGender:function(){
                $("#save-basic-profile").removeClass("disabled").addClass("pf-hover-primary-color");
            },            
            updatePassword:function(e){
                var $this = $("#maresetPass");
                var error = true;
                var formId = "maresetPass";
                error = PF.HEADER.validateForm("",formId);
                if(!error){
                    $("#maresetPass").submit();
                }
                
            },
            removeFromWishlist: function () {
                var id = $(this).attr('data-id');
                var type = $(this).attr('data-type'); //added data type for wardrobe products
                var response = confirm('Do you want to remove this item from wishlist ?');
                if (response === false)
                {
                    return false;
                }
                if (type == "bundle") {
                    utils.removeFromWishlist(id, o.removeFromWishlistHandler, '', 1);
                } else if(type == "look") {
                    utils.removeFromWishlist(id, o.removeFromWishlistHandler, '', undefined, 1);
                } else{
                    utils.removeFromWishlist(id, o.removeFromWishlistHandler);
                }
            },
            removeFromWishlistHandler: function (d) {
                d = parseInt(d);
                if (!isNaN(d) && d === 1) {
                    window.location.reload();
                }
                else {
                    alert(o.processError);
                }
            },            
            submitWishlistComment: function (e) { 
                
                var id = $(this).closest("form").attr('data-id');                
                var type = $(this).closest("form").attr('data-type'); //added data type for wardrobe products
                var $form = $('#wishlist_form-' + id);
                var $textarea = $form.find('textarea');
                var formId="wishlist_form-"+id;
                var validation=PF.HEADER.validateForm('',formId);
                var comments = $.trim(o.escapeHtml($textarea.val()));
                if(!validation)
                {
                    $textarea.html(comments);

                    if (type == 'bundle') {
                        var _url = secure_url + "/site_wardrobe/addComments";
                    } else if(type == 'look') {
                        var _url = secure_url + "/look/addComments";
                    } else {
                        var _url = secure_url + "/customer_wishlist/addComments";
                    }
                    utils.makeRequest(
                            _url,
                            'POST',
                            {
                                comments: comments,
                                item_id: id
                            },
                    o.submitWishlistCommentSuccess,
                            PF.ERROR.raiseError,
                            '',
                            {
                                id: id,
                                comments: comments
                            }
                    );
                }

                return false;
            },
            myOrdersSearchByOrderNo: function () {
                var $this = $(this),
                val = $.trim($this.val());
                if (isNaN(val)) {
                    $this.val('');
                    return;
                }
                $this.parent().find('#clear_order_search_box').css('visibility', function () {
                    if(val !== ''){
                        $("#maSrchBtn").css("visibility","hidden");
                    }
                    else{
                        $("#maSrchBtn").css("visibility","visible");
                    }
                    return (val !== '') ? 'visible' : 'hidden';
                    
                });
                
            },
            myOrdersMonthFilter: function () {                
                var period = this.options[this.selectedIndex].value;
                window.location =  (!isNaN(period) && period !== 0)?secure_url + '/customer/myorders?period=' + period: secure_url+'/customer/myorders';
            },
            trackOrder: function () {
                var $this = $(this);
                if ($this.attr('disabled') === 'disabled')
                    return;
                $this.attr('disabled', 'disabled');
                var id = $this.attr('data-id');
                var pid = $this.attr('data-pid');
                var _url = secure_url + '/customer_trackOrder/trackItem/' + id + '/' + pid + '/myorders';
                $('.tyo_popup_box').remove();

                var _container = ($('#viewOrderTab').length > 0) ? '#viewOrderTab' : '#accountDashboardTab';

                utils.makeRequest(
                        _url,
                        'GET',
                        {},
                        function (d, e) {
                            $('.tyo_popup_box').remove();
                            $("#deliveryStatus").html(d);
                            $this.removeAttr('disabled');
                        },
                        PF.ERROR.raiseError,
                        function(){
                            //before Send handler
                        },
                        {
                            id: id,
                            container: _container
                        }
                );
                
            },
            submitReturnFrom: function (e) {
                var currentItemId = $(this).attr("itemid");
                e.preventDefault();
                // Validation
                var is_valid = true;
                var $this = $(this);
                var errorHtml;
                var page_type = $this.attr('form-type');
                var reason = $('#reason_select_'+$this.attr('itemid')).val();
                var comments = $('#ws_comments_'+$this.attr('itemid')).val();
                currentItemId = $("#return-item-form-"+currentItemId+" .currentItemId").val();
                var fileSize = 0;
                var file = "";
                var file_extension = "";
                if($('.file-uploaded-wrap .uploade-img-list').length>0){
                    file = $('.file-uploaded-wrap .uploade-img-list:first').find("p").text();
                    file_extension =file.split('.').pop().toLowerCase();
                    fileSize= parseInt($('.file-uploaded-wrap .uploade-img-list:first').attr('fsize'));
                }
                $("#return-item-form-"+currentItemId+" .invalid_file2").css({"display":"none","color":"#969696"});
                $("#return-item-form-"+currentItemId+" #invalid_file").html("Choose File .jpg, .jpeg, .png, .bmp Only. Max Size 5 Mb").css({"color":"#969696"});
                $this.find("#return-item-form-"+currentItemId+" .error-msg").css("display","none");
                
                if(reason == '') {
                    $('#reason-wrap-'+$this.attr('itemid')).find(".error-msg").css("display","block");
                    is_valid = false;
                }
                else{
                    $('#reason-wrap-'+$this.attr('itemid')).find(".error-msg").css("display","none");
                }                
                if(file === '' && is_valid === true && reason!='Incomplete items or contents missing') {
                    $("#return-item-form-"+currentItemId+" .invalid_file2").css({"display":"block","color":"#d0021b"});
                    is_valid = false;
                }
                else{
                    $("#return-item-form-"+currentItemId+" .invalid_file2").css({"display":"none","color":"#969696"});
                }
                
                if(file_extension === "" && is_valid === true && reason!='Incomplete items or contents missing'){
                    $("#return-item-form-"+currentItemId+" #invalid_file").css('color','#d0021b');
                        is_valid = false;                        
                }
                else{
                    if($.inArray(file_extension, ['doc','docx','jpg','jpeg','bmp','png']) === -1 && is_valid === true && reason!='Incomplete items or contents missing') {
                        $("#return-item-form-"+currentItemId+" #invalid_file").css('color','#d0021b');
                        is_valid = false;
                    }
                    else{
                        $("#return-item-form-"+currentItemId+" #invalid_file").css('color','#969696');                    
                    }
                }
                if(is_valid === true && (fileSize==0 || fileSize>1049576*5) && reason!='Incomplete items or contents missing') {
                    $("#return-item-form-"+currentItemId+" #invalid_file").css('color','#d0021b');
                    is_valid = false;
                }else{
                    $("#return-item-form-"+currentItemId+" #invalid_file").css('color','#969696');                    
                }
                
                if(is_valid){                    
                    is_valid = !(PF.HEADER.validateForm("","return-item-form-"+currentItemId));
                }
                
                if(is_valid) {
                    $this.attr('disabled', 'disabled').addClass('btn-blue btn-loader');
                    var formData = $('#return-item-form-'+$this.attr('itemid')).serialize();
                    o.callBack(formData, $this, page_type);
                }
            },
            callBack : function( formData, t ,page_type) {
                var $this = t;
                var _url = secure_url + '/customer/return_request';
                // fire ajax call
                var _ajaxSetUpOptions = {
                    //contentType : false,
                    processData : false,
                    cache : false
                };
                utils.makeRequest(
                    _url,
                    'POST',
                    formData,
                    function (d) {
                       var return_data = $.parseJSON(d);
                       if(return_data.status == 1) {
                           if(page_type == 1) {
                                $("#returnItemModal-"+$this.attr('itemid')).removeAttr('data-modal').attr('href', 'javascript:void(0);').css('cursor', 'default').addClass('disabled-tt').text('Return Initiated').attr('data-tooltip', 'Return Already initiated');
                                $(".popup-close").click();
                                $this.removeAttr("disabled").removeClass('btn-blue btn-loader');
                            } else { 
                                // replace div with success message
                                $("#return-reason-form-"+$this.attr('itemid')).hide();
                                $('#return-form-success-message-'+$this.attr('itemid')).show();
                           } 
                       } else {
                          // error
                          $this.removeAttr("disabled").removeClass('btn-blue btn-loader');
                          if(return_data.status == 2) {
                            $('div.error-text').remove();  
                            var file_warp = $("#file-wrap-"+$this.attr('itemid'));
                            var errorHtml;
                            if(return_data.error.upload_error === 'Upload error!!, Please select a file again'){
                                errorHtml = o.formErrorHtml.replace('{{ERROR}}', return_data.error.upload_error);
                            }else{
                                errorHtml = o.formErrorHtml.replace('{{ERROR}}', return_data.error.invalid_size);
                            }
                            file_warp.addClass('input-error').append(errorHtml);
                            file_warp.find('div.error-text').show();
                          }
                          if(return_data.status == -1) {
                            alert(return_data.message);
                          }
                       }
                    },
                    PF.ERROR.raiseError,
                    '',
                    {
                        //id : id,
                        //container : _container
                    },
                    _ajaxSetUpOptions
            );
            },
            loadOrders: function (e) {
                e.preventDefault();
                var current_element = $(this);
                var current_page = parseInt(current_element.attr('page')) + 1;
                // load the order template by ajax call and append
                var _url = secure_url + '/customer/loadorders';

                utils.makeRequest(
                        _url,
                        'GET',
                        {
                            p: current_page
                        },
                function (d, e) {
//                    current_element.remove();
                    $(".view-more-return-orders").remove();
                    $("#return-orders-wrap-container").append(d);
                    $("#return_item_load_btn").attr('page', current_page);
                },
                        PF.ERROR.raiseError,
                        '',
                        {
                            //id : id,
                            //container : _container
                        }
                );
            },
            callUploadFile:function(){
                $(this).closest("form").find(".rpImage").trigger('click');
            },
            resetReturnItemPopup:function(){
                $(this).closest("form").trigger("trigger");
                $(this).closest("file-uploaded-wrap").html("");
            },
            uploadFileOnSelect:function(){
                var currentItemId = $(this).closest("form").find(".return-order-submit").attr("itemId");
                var currentId = parseInt($("#return-item-form-"+currentItemId+" .file-uploaded-wrap .uploade-img-list").length)+1;
                if(currentId>0){
                    $("#return-item-form-"+currentItemId+" .file-upload-wrap").hide();
                }
                else{
                    $("#return-item-form-"+currentItemId+" .file-upload-wrap").show();
                }
                var type = $('#filesUpload-'+currentItemId)[0].files[0].name.split('.').pop().toLowerCase();
                var size = $('#filesUpload-'+currentItemId)[0].files[0].size;
                 switch (type) {
                        case 'doc': 
                        case 'docx': 
                        case 'jpg':
                        case 'jpeg': 
                        case 'png': 
                        case 'bmp':
                                if(currentId>=o.maxFilesToUpload){
                                    $('#return-item-form-'+currentItemId+' .add-more-file').hide();
                                }    
                                if(size<=1049576*5){
                                    $('#return-item-form-'+currentItemId+' #invalid_file').hide();
                                    if(currentId <=o.maxFilesToUpload){
                                        o.getDataFeedback(type,currentId,currentItemId);
                                    }
                                    else{
                                        
                                        $('#return-item-form-'+currentItemId+' .add-more-file').hide();
                                        $('#return-item-form-'+currentItemId+' #invalid_file').html('Max 5 files are allowed!').css('color','#d0021b');
                                        if(currentId >= 5){
                                            $('#return-item-form-'+currentItemId+' .add-more-file').hide();
                                        }
                                        return false;
                                    }
                                }
                                else{
                                    if(currentId ==1){
                                        $(".file-upload-wrap").show();
                                    }
                                    $('#return-item-form-'+currentItemId+' #invalid_file').html('Max 5Mb allowed!').css('color','#d0021b').show();
                                    if(currentId >= o.maxFilesToUpload){
                                        $('#return-item-form-'+currentItemId+' .add-more-file').hide();
                                    }
                                    return false;
                                }
                            break;
                        default:
                            $(".file-upload-wrap").show();
                            $('#return-item-form-'+currentItemId+' #invalid_file').css('color','#d0021b');
                            $('#return-item-form-'+currentItemId+' .return-order-submit').removeAttr('disabled');
                            $('#return-item-form-'+currentItemId+' .return-order-submit').removeClass('disabled');
                            $('#return-item-form-'+currentItemId+' .return-order-submit').val('Return Item');
                            var file_warp = $("#return-item-form-"+currentItemId+" #file-wrap-"+currentItemId);
                            $('div.error-text').remove();
                            var errorHtml = o.formErrorHtml.replace('{{ERROR}}', o.formErrorMsg.file_error.file_extension);
                            file_warp.addClass('input-error').append(errorHtml);
                            file_warp.find('div.error-text').show();
                        return false;
                    }
            },
            getDataFeedback : function(type,currentId,formId){
                var currentItemId = $("#return-item-form-"+formId+" .currentItemId").val();
                if(typeof(currentId)=='undefined'){
                    currentId='';
                }
                var i =1;
                var loaded = 0;
                var step = 1048576;
                var total =$('#filesUpload-'+currentItemId)[0].files[0].size;
                var totalRequest = 5;//Math.ceil(total/step);
                var start = 0;
                var name = encodeURIComponent( $("#return-item-form-"+currentItemId+' #filesUpload-'+currentItemId)[0].files[0].name );
                var randName = Math.random().toString(36).substr(2, 30);
                var parts = name.split(".");
                var fileNameWA = parts[0];
                name = encodeURIComponent( fileNameWA+randName+"."+type );
                var resFlag = 1;
                var uploaded = document.getElementById('feddback_rpImage_'+currentId);

                var reader = new FileReader();

                reader.onload = function(e){
                        var xhr = new XMLHttpRequest();
                        var upload = xhr.upload;
                        xhr.onreadystatechange = function() {
                                // if( xhr.readyState == XMLHttpRequest.DONE ) {
                                if( this.readyState == 4 && this.status == 200 ) {
                                        var fileRes = xhr.responseText;
                                        if (fileRes === "invalid_file" && resFlag === 1)
                                        {
                                            alert("Invalid image file!");
                                            $('#invalid_size').html('Invalid image file!');
                                            $('#feddback_rpImage_'+currentId).html('Choose File');
                                            $('#return-item-form-'+formId+' .return-order-submit').removeClass('disabled');
                                            $('#return-item-form-'+formId+' .return-order-submit').removeAttr('disabled');
                                            $('#return-item-form-'+formId+' .return-order-submit').val('Return Item');                                           
                                            
                                            xhr.abort();
                                            resFlag = 0;
                                            loaded=total*100;
                                            return;
                                        }
                                        if( totalRequest < i ) {
                                            if(fileRes === "image_size_exeeded" && resFlag === 1){
                                                alert("Image is too big! Please reduce the size of your photo using an image editor. Max 5 MB is allowed.");
                                                $('#invalid_file').html('Max 5Mb allowed!');
                                                $('#feddback_rpImage_'+currentId).html('Choose File');
                                                $('#return-item-form-'+formId+' .return-order-submit').removeClass('disabled');
                                                $('#return-item-form-'+formId+' .return-order-submit').removeAttr('disabled');
                                                $('#return-item-form-'+formId+' .return-order-submit').val('Return Item');
                                                xhr.abort();
                                                resFlag = 0;
                                                loaded=total*100;
                                                return;
                                            }
                                        }
                                        
                                        if(loaded >= total){
                                            $('#return-item-form-'+formId+' .return-order-submit').removeClass('disabled');
                                            $('#return-item-form-'+formId+' .return-order-submit').removeAttr('disabled');
                                            $('#return-item-form-'+formId+' .return-order-submit').val('Return Item');
                                            if(resFlag){
                                                //$('#feddback_rpImage_'+currentId).html($('#rpImage_'+currentId).val().replace(/C:\\fakepath\\/i, ''));
                                                //$('#fileContaier_'+currentId).show();
                                                $("#return-item-form-"+currentItemId+" .rpImage").val("");
                                                var srNo = parseInt($("#return-item-form-"+currentItemId+" .file-uploaded-wrap .uploade-img-list").length)+1;

                                                var htmlStr="<div class='uploade-img-list' sr-no='"+srNo+"' fsize='"+total+"'>"+"<p class='uploaded-img'>"+fileRes+"</p>"+"  <a href='javascript:;' class='pf-text-brown remove-file font-12'>Remove</a> </div>";
                                                
                                                if(o.oneTimeLoad){
                                                    $(".remove-file, .add-more-file").css({'display':'inline-block', 'margin-top':'-1.5rem'});
                                                    var htmlDom  = $("#return-item-form-"+currentItemId+" .file-uploaded-wrap").html(htmlStr);
                                                     $(".remove-file").css({'display':'inline-block', 'margin-top':'-1.5rem'});
                                                    o.oneTimeLoad=false;
                                                }else{                                                           
                                                    $("#return-item-form-"+currentItemId+" .file-uploaded-wrap .uploade-img-list").parent().append(htmlStr);
                                                    $(".remove-file").css({'display':'inline-block', 'margin-top':'-1.5rem'});
                                                    if($("#return-item-form-"+currentItemId+' .uploade-img-list').length == o.maxFilesToUpload){
                                                        $("#return-item-form-"+currentItemId+".add-more-file").hide();        
                                                    }
                                                }
                                                
                                            }else{
                                                $('#feddback_rpImage_'+currentId).html('Choose File');
                                            }
                                            
                                            xhr.abort();
                                            resFlag = 0;
                                            loaded=total*100;
                                            return;
                                        }
                                }
                        }
                        upload.addEventListener('load',function(){
                                loaded += step;
                                var _p = (loaded/total) * 100;
                                if( _p > 100 ) {
                                        _p = 100;
                                }
                                $("#return-item-form-"+currentItemId).find("input[type=submit]").addClass("btn-loader").attr('disabled','disabled');
                                if(loaded <= total){
                                        blob = $('#filesUpload-'+currentItemId)[0].files[0].slice(loaded,loaded+step);

                                        reader.readAsBinaryString(blob,o.log);
                                }else{
                                        loaded = total;
                                        $("#return-item-form-"+currentItemId).find("input[type=submit]").removeClass("btn-loader").removeAttr('disabled');
                                }
                        },false);                        
                        if(resFlag){
                            xhr.open("POST", root_url+"/customer/feedbackFileUpload?fileName="+name+"&fileType="+type+"&fileSize="+total+"&nocache="+new Date().getTime()+"&totalRequest="+totalRequest+"&currentId="+currentId+"&count="+i++);
                            xhr.overrideMimeType("application/octet-stream");
                            xhr.sendAsBinary(e.target.result);
                        }
                };

                var blob = $('#filesUpload-'+currentItemId)[0].files[0].slice(start,step);
                reader.readAsBinaryString(blob,o.log);
            },
            removeUploadedFile : function(){
                var wrapLength = $(this).parent('.uploade-img-list').parent('.file-uploaded-wrap').find('.uploade-img-list').length;           
                $(this).parents(".uploade-img-list").remove();
                $(".rpImage").val("");
                $(".rpImage").parent("div").find("label").text("Choose file");
                
                if(wrapLength == 1){                    
                    o.oneTimeLoad=true; 
                    $(".file-upload-wrap").show();
                    $(".add-more-file").hide();
                }else{
                    $(".file-upload-wraped").hide();    
                    $(".add-more-file").show();        
                }
                
                var srno = $(this).parent("div.uploade-img-list").attr('sr-no');
                $.ajax
                ({
                    url: root_url + '/customer/delUploadedImage',
                    data: { "srno":srno},
                    type: "POST",
                    async: true,                
                    success: function (data) 
                    {                         

                    }
                });
                
            },
            escapeHtml : function(unsafe) {
                return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            },
            submitWishlistCommentSuccess: function (d, e) {
                d = parseInt(d);
                if (!isNaN(d) && d === 1) {
                    var commentsText = e.comments.length>50?e.comments.slice(0, 50):e.comments;
                    var readmore = e.comments.length>50?"<a href='javascript:;' class='ma-comment-readmore' data-modal='wishlist_comment_popup_"+e.id+"'>Read More</a>":"";
                    $("#comment_" + e.id).html(o.escapeHtml(commentsText)).append(readmore);
                    $('#wishListCommentPopupClose').trigger('click');
                } else {
                    alert(o.processError);
                }
            },
            myOrdersClearSearchBox: function () {
                $(this).css('visibility', 'hidden');
                $("#maSrchBtn").css('visibility', 'visible');
                $('#order_no').val('').focus();
                var orderNo = parseInt(utils.getParameterByName('order_id'));
                if (!isNaN(orderNo) && orderNo !== 0) {
                    window.location = secure_url + '/customer/myorders';
                }
            },
            chooseRating:function(){
                if ($(this).val() <= '3') {                          
                    $(this).parent('.feedback-rate').siblings('.Detail-Reason').show();
                    $(this).parent('.feedback-rate').siblings('.thank-for-reviewDetail').hide();
                } 
                else {
                    saveRating($(this).closest("form").attr("id"));
                    $(this).closest("form").find("input,select").attr("disabled","disabled");
                    $(this).parent('.feedback-rate').siblings('.Detail-Reason').hide();
                    $(this).parent('.feedback-rate').siblings('.thank-for-reviewDetail').show();
                }
            },
            changeFeedbackReason:function(){
                $(this).parent().hide('.Detail-Reason');
                $(this).parent('.Detail-Reason').siblings('.thank-for-reviewDetail').show();
                if($(this).val().trim().length>0){
                    saveRating($(this).closest("form").attr("id"));
                    $(this).closest("form").find("input,select").attr("disabled","disabled");
                } 
            },
            openRatingHtml:function(){
                $(this).find('.myacnt-shrfdbck').addClass('strt-fdbckstp');
            },
            closeRatingHtml:function(){
                $(this).find('.myacnt-shrfdbck').removeClass('strt-fdbckstp');
            },
            slideHtml:function(){
                $(this).parents('.fdbck-wrprmyacc').addClass('slide');
                $(this).parents('.fdbck-wrprmyacc').remove();      
            },
            save_rating:function(){    
                
                if(!$(this).hasClass('myacc-fdbcksbmt-btn')){
                    var currentPositionDiv = $(this).closest('.myacc-fdbckcntnt');
                    var feedbackScrnno = parseInt($(this).closest('.myacnt-shrfdbck').find('.fdbck-scrn-no').text());
                    feedbackScrnno++;
                    $(this).closest('.myacnt-shrfdbck').find('.fdbck-scrn-no').html(feedbackScrnno);
                    $(currentPositionDiv).addClass('slide'); 
                }
                
                var $this = $(this);
                var rating = $this.attr('value');
                var oId = $this.attr('order_id');
                var iId = $this.attr('item_id');
                var ratingType = $this.attr('rating_type');
                
                var slide_count = 1;
                if (ratingType == 'over_all_rating') {
                    slide_count = 1;
                } else if (ratingType == 'delivery_time_rating') {
                    slide_count = 2;
                } else if (ratingType == 'item_quality_rating') {
                    slide_count = 3;
                } else {
                    slide_count = 4;
                }
                
                var comment = '';
                if (ratingType == 'comment') {
                    var feedbackBox = $("#feedback_text_" + oId + "_" + iId);
                    comment = feedbackBox.val().trim();
                    if(comment == ''){
                        feedbackBox.next('.myacc-errmsg').addClass('show');
                    }
                    else{
                        $(this).closest('.fdbck-wrprmyacc').addClass('slide');
                        $(this).closest('.fdbck-wrprmyacc').remove();
                    }
                }

                var _url = secure_url + '/customer/save_rating';
                
                utils.makeRequest(
                    _url,
                    'POST',{ rating: rating,comment: o.escapeHtml(comment),order_id: oId,item_id: iId,rating_type: ratingType},
                    function (d, e) {   
                        var json_data = $.parseJSON(d);
                        if (json_data.status == '2') {
                            window.location.reload();
                        }
                    },
                    PF.ERROR.raiseError,
                    '',
                    {}
                ); 
                
            }
            
        };
        z.MYACCOUNT = o;
    }(PF, $));

    $(document).ready(function () {
        PF.MYACCOUNT.init();

        /* Show Learn more tab selected to link easy returns across the site*/        
        //PF.MYACCOUNT.loadlmreturn();        
    });
}

function deleteInvoiceFile(invoice){
    $.post(root_url+'/merchant/deleteinvoicepdf/'+invoice);
}
$(document).ready(function(){ 
    var status = $('#status');
    //added by pradip humane
	$(".add_awb").click(function() {
		var $orderid_itemid=$(this).attr("rel").split("_");
		$("#itemid").text($orderid_itemid[1]);
		$("#order_id").text($orderid_itemid[0]);
		$("#awbBox").fadeIn(50); 
	});

	$(".cross").click(function(){
		$("#"+ $(this).attr('rel')).fadeOut(50);
                //this condition is written becoz on register sign in popup get refreshed , to stop this wrote this
                if($('#merchant_register_login').val() == "")
                {
                    window.location.reload();
                }
		return false;
	}); 

	$('.merchant_add').click(function(){
		var id=this.id;
		if(id > 0)
		{
			$('#address'+id).attr('checked','checked');
		}
		
	});

	$("#addressForm").click(function(){
		$('#addressTab').fadeIn(50);
	});

	$("#addressSubmit").click(function(){
		$('.error_msg').html('').removeClass('validation-advice');
		var errors=0;
		
		if($.trim($('#textAddress').val()) == '')
		{
			$('#addressMsg').html('Please enter your address');
			$('#addressMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			var filter= /^[A-Za-z0-9\s\'-_,#&\/\/]+$/;
			if(!filter.test($.trim($('#textAddress').val())))
			{
				errors=1;
				$('#addressMsg').html('Please enter a valid address');
				$('#addressMsg').addClass('validation-advice');
			}
		}

		if($.trim($('#city').val()) == '')
		{
			$('#cityMsg').html('Please enter your city');
			$('#cityMsg').addClass('validation-advice');
			errors=1;
		}

		if($.trim($('#textState').val()) == '')
		{
			//$('#state').css('border', 'solid 1px red');
			$('#stateMsg').html('Please select your state');
			$('#stateMsg').addClass('validation-advice');
			errors=1;
		}
		

		if($.trim($('#textPincode').val()) == '')
		{
			$('#pincodeMsg').html('Please enter your pincode');
			$('#pincodeMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			
			if($.trim($('#textPincode').val()).length != 6)
			{
				errors=1;
				$('#pincodeMsg').html('Please enter a 6-digit valid pincode ');
				$('#pincodeMsg').addClass('validation-advice');	
			}
		}

		if($.trim($('#textPhone').val()) == '')
		{
			$('#phoneMsg').html('Please enter your phone number');
			$('#phoneMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			if($.trim($('#textPhone').val()).length != 11)
			{
				errors=1;
				$('#phoneMsg').html('Please enter a 11-digit valid landline number (e.g. 0222830XXXX)');
				$('#phoneMsg').addClass('validation-advice');
			}

			var filter= /^[0-9]+$/;
			if(!filter.test($.trim($('#textPhone').val())))
			{
				errors=1;
				$('#phoneMsg').html('Only Digits are allowed for Phone Number');
				$('#phoneMsg').addClass('validation-advice');
			}
		}
		if(errors==0)
		{
			var form_data=$("#add_address").serialize();
			var url = root_url + '/merchant/postAddress';
			$.ajax({
				type: 'POST',
				url: url,
				data:{data:form_data},
				async: false,
				beforeSend: function() {
					
				},
				success: function(resulthtml)
				{
					if(resulthtml=='success')
					{
						window.location.reload();
					}
					else
					{
						$('#header_error').html(resulthtml);
					}
					//alert('in success');				
					//$("#div-loader-wait").hide();
				},
				error: function(message)
				{
					alert('error');
				}
			});
		}
		return false;
	});

	$('#bulk_inv').click(function(){
		alert('hi invoice');
	});

	$('#bulk_ship').click(function(){
		alert('hi ship');
	});

	$("#btnAddawb").click(function(){
         var url = root_url + '/sales_shipment/addshipment';
         //var url = root_url + '/merchant/addawb';
         var $itemid=$("#itemid").text();
         var $orderid=$("#order_id").text();
         //alert("item id "+$itemid+"  Order "+$orderid);
         var $awb=$('#txtAwb').val();
         var $shipmentdate=$("#txtShipmentdate").val();
         if($awb == "")
         {
             alert("Enter AWB number");
         }
         else if($shipmentdate == "")
         {
             alert("Enter shipment date ");
         }
         else
         {
			$(this).prop('disabled',true);
			$(this).prop('value', 'Please Wait');

            var form_data=$("#awbfrm").serialize()+"&order_id="+$orderid+"&shipment%5Bitems%5D%5B"+$itemid+"%5D="+$itemid+"&send_sms=yes&send_email=yes&shipment_comment_text='ship by merchant'";
             //var form_data=$("#awbfrm").serializeArray();
             
             //form_data['shipment']['items'][$pid]=$pid;             
             //alert(form_data);
            //var $querystring="carrier="+$carrier+"&awb="+$awb+"&shipmentdate="+$shipmentdate+"&orderid_pid="+$orderid_pid;
            $.ajax({
                    type: 'POST',
                    url: url,
                    data:{data:form_data},
                    async: false,
                    beforeSend: function() {
						//  
                    },
                    success: function(result)
                    {                                           alert(result);
                       $("#awbBox").fadeOut(50);
                       location.reload();
                    },
                    error: function(message)
                    {
                      alert('error. Please Resend the code.' + message.toSource());
                    }
            });
			 $(this).prop('enabled',true);
			$(this).prop('value', 'SUBMIT');
         }
     });
     $( ".date_input_first" ).datepicker({dateFormat:'yy-mm-dd'});
	 $(".shipment_date_pick").datepicker({dateFormat:'yy-mm-dd'});
    //end

	//print invoice start
	$('.print_invoice').click(function(){
		var orderid_itemid=$(this).attr("rel").split("__");
		$('#order_entity_id').val(orderid_itemid[0]);
		$('#order_item_id').val(orderid_itemid[1]);
		$("#invoicePrint").fadeIn(50); 
		$('#textInvoice').val('');
	});

	$('#btnPrint').click(function(){
		//alert('hi'); 
		var errors=0;
		$('#invoice_detail .error_msg').html('').removeClass('validation-advice');	
		
		if($.trim($('#invoice_detail #textInvoice').val()) == '')
		{
			//$('#invoice_detail #company').css('border', 'solid 1px red');
			$('#invoice_detail #invoiceMsg').html('Please enter your invoice number');
			$('#invoice_detail #invoiceMsg').addClass('validation-advice');
			errors=1;
		}
		
		/*if($.trim($('#invoice_detail #textAddress').val()) == '')
		{
			$('#invoice_detail #addressMsg').html('Please enter your address');
			$('#invoice_detail #addressMsg').addClass('validation-advice');
			//$('#invoice_detail #street').css('border', 'solid 1px red');
			errors=1;
		}
		else
		{
			var filter= /^[A-Za-z0-9\s\'-_,&\/\/]+$/;
			if(!filter.test($.trim($('#invoice_detail #textAddress').val())))
			{
				errors=1;
				$('#invoice_detail #addressMsg').html('Please enter a valid address');
				$('#invoice_detail #addressMsg').addClass('validation-advice');
			}
		}

		if($.trim($('#invoice_detail #city').val()) == '')
		{
			//$('#invoice_detail #city').css('border', 'solid 1px red');
			$('#invoice_detail #cityMsg').html('Please enter your city');
			$('#invoice_detail #cityMsg').addClass('validation-advice');
			errors=1;
		}

		if($.trim($('#invoice_detail #textState').val()) == '')
		{
			$('#invoice_detail #stateMsg').html('Please select your state');
			$('#invoice_detail #stateMsg').addClass('validation-advice');
			errors=1;
		}

		if($.trim($('#invoice_detail #textPincode').val()) == '')
		{
			$('#invoice_detail #pincodeMsg').html('Please enter your pincode');
			$('#invoice_detail #pincodeMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			if($.trim($('#invoice_detail #textPincode').val()).length != 6)
			{
				errors=1;
				$('#invoice_detail #pincodeMsg').html('Please enter a 6-digit valid pincode ');
				$('#invoice_detail #pincodeMsg').addClass('validation-advice');	
			}
		}

		if($.trim($('#invoice_detail #textPhone').val()) == '')
		{
			$('#invoice_detail #phoneMsg').html('Please enter your phone number');
			$('#invoice_detail #phoneMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			if($.trim($('#invoice_detail #textPhone').val()).length != 11)
			{
				errors=1;
				$('#invoice_detail #phoneMsg').html('Please enter a 11-digit valid landline number (e.g. 0222830XXXX)');
				$('#invoice_detail #phoneMsg').addClass('validation-advice');
			}

			var filter= /^[0-9]+$/;
			if(!filter.test($.trim($('#invoice_detail #textPhone').val())))
			{
				errors=1;
				$('#invoice_detail #phoneMsg').html('Only Digits are allowed for Phone Number');
				$('#invoice_detail #phoneMsg').addClass('validation-advice');
			}
		}
		*/

		if($.trim($('#invoice_detail #textTin').val()) == '')
		{
			$('#invoice_detail #tinMsg').html('Please enter your TIN number');
			$('#invoice_detail #tinMsg').addClass('validation-advice');
			errors=1;
		}

		if($.trim($('#invoice_detail #textVat').val()) == '')
		{
			$('#invoice_detail #vatMsg').html('Please enter your VAT number');
			$('#invoice_detail #vatMsg').addClass('validation-advice');
			errors=1;
		}

		if($.trim($('#invoice_detail #textCst').val()) == '')
		{
			$('#invoice_detail #cstMsg').html('Please enter your CST number');
			$('#invoice_detail #cstMsg').addClass('validation-advice');
			errors=1;
		}
		//alert(erros); return false;
		if(errors==1)
		{
			return false;
		}
		else
		{
			//$('#textInvoice').val('');
			$("#invoicePrint").fadeOut(50);
                        setTimeout('deleteInvoiceFile('+$.trim($('#invoice_detail #textInvoice').val())+');',20000);
			//location.reload();
		}
	});

	$('#btnPrint1').click(function(){
		url= root_url + '/merchant/printInvoice';
		var form_data=$("#invoice_detail").serialize();
		//alert(form_data);
		 $.ajax({
			type: 'POST',
			url: url,
            data:{data:form_data},
			async: false,
            beforeSend: function() {
				//alert('Sending the code');	
			},
            success: function(result)
            {
				alert(result);
                //$("#awbBox").fadeOut(50);
                //location.reload();
			},
            error: function(message)
            {
              alert('error. Please Resend the code.' + message.toSource());
            }
		});
		alert('end');
		return false;
	});
	//print invoice end

	//cancel request start
	$('.cancel_request').click(function(){
		var orderid_itemid=$(this).attr("name").split("__");
		$('#order_entity_id').val(orderid_itemid[0]);
		$('#order_item_id').val(orderid_itemid[1]);
		$('#order_item_sku').val(orderid_itemid[2]);
		$('#order_increment_id').val(orderid_itemid[3]);
		$("#cancelBox").fadeIn(50); 
		//alert($(this).attr('name'));
	});

	$('#cancel_order_request').on("click",function(){
		var order_id=$('#order_entity_id').val();
		var order_item_id=$('#order_item_id').val();
		var order_item_sku=$('#order_item_sku').val();
		var order_increment_id=$('#order_increment_id').val();
		var reason=$.trim($('#reason').val());
		
		if(reason=='')
		{
			alert('Please select one of the reason for Cancellation');
			return false;
		}
		else if(order_id=='' || order_item_id=='')
		{
			alert('Try Later');
			return false;
		}
		else
		{
			$(this).prop('disabled',true);
			$(this).prop('value', 'Please Wait');
			url= root_url + '/merchant/cancelOrderRequest';
			$.ajax({
				type: 'POST',
				url: url,
				data:{order_id:order_id,order_item_id:order_item_id,order_item_sku:order_item_sku,order_increment_id:order_increment_id,reason:reason},
				async: false,
				beforeSend: function() {
					
				},
				success: function(result)
				{
					if(result=='success')
					{
						alert('Request made succesfully!!!');
						location.reload();
					}
					else
					{
						alert(result);
					}
				},
				error: function(message)
				{
				  alert('error. Please Resend the code.' + message.toSource());
				}
			});
			$(this).prop('disabled',false);
			$(this).prop('value', 'Cancel Order');
		}
		return false;

	});
	//cancel request end

	/* 
		Return item action start
	*/

	$('.return_item').click(function(){
		if(window.confirm("The action will confirm that you have recieved this item back in perfect condition. Do you wish to continue?"))
		{
			var orderid_itemid=(this).id;
			var orderid_itemid=orderid_itemid.split("__");

			var item_id=orderid_itemid[0];
			var order_id=orderid_itemid[1];
			
			if(item_id > 0 && order_id > 0)
			{
				$(this).prop('disabled',true);
				var button_value=$(this).prop('value');
				$(this).prop('value', 'Please Wait');
				url= root_url + '/merchant/itemRecieved';
				$.ajax({
					type: 'POST',
					url: url,
					data:{item_id:item_id,order_id:order_id},
					async: false,
					beforeSend: function() {
						
					},
					success: function(result)
					{
						if(result=='success')
						{
							alert('Request submitted succesfully!!!');
							location.reload();
						}
						else
						{
							alert(result);
						}
					},
					error: function(message)
					{
					  alert('error. Please Resend the code.' + message.toSource());
					}
				});

				$(this).prop('disabled',false);
				$(this).prop('value', button_value);
			}
		}
	});

	/* 
		Return item action end
	*/

	
	/*
	Bulk download button start
	*/

	$('.link_selects').click(function(){
		var val=$(this).attr('rel');
		$('.link_selects').removeClass('selected');
		$(this).addClass('selected');

		if(val==1 || val==3)
		{
			$('.order_item').attr('checked','checked');
		}
		else if(val==2 || val==4)
		{
			$('.order_item').attr('checked',false);
		}

		$('#select_record').val(val);

		showSelectedrecords(val);

	});

	$(".select_record").click(function(){
		//alert($(this).val());
		var val=$(this).val();
		if(val==1 || val==3)
		{
			$('.order_item').attr('checked','checked');
		}
		else if(val==2 || val==4)
		{
			$('.order_item').attr('checked',false);
		}

		showSelectedrecords(val);
	});

	$('.download_submit').click(function(){
		var order_item_id=[];
		var order_item = 0;
		var bulk_direct_ship=0;

		$('.order_item:checked').each(function() {
			order_item_id.push($(this).val());
			order_item = order_item + 1;
			
			if((this).id=='direct_ship_check')
			{
				bulk_direct_ship = bulk_direct_ship + 1;
			}
		});
		//alert(order_item_id);

		if((this).id=='shipment_submit' || (this).id=='invoice_submit')
		{
			/*$('.bulk_direct_ship').each(function() {
				bulk_direct_ship = bulk_direct_ship + 1;
			});*/

			if(order_item > 0 || bulk_direct_ship > 0)
			{
				if(bulk_direct_ship != order_item)
				{
					alert('Some of the Order SKU\'s are not available for Direct Ship. Please Uncheck that Order - SKU and Download file.');
					return false;
				}
			}

		}
		
		if(order_item_id=='')
		{
			alert('Please select records to download the file');
			return false;
		}
	});
	/*
	Bulk download button end
	*/


	$('#manifest_submit').click(function(){
		$('.error_msg').html('').removeClass('validation-advice');

		var errors=0;

		if($.trim($('#carrier').val())=='')
		{
			errors=1;
			$('#carrierMsg').html('Please select carrier code');
			$('#carrierMsg').addClass('validation-advice');

		}

		if($.trim($('#custom_design_from').val())=='' && $.trim($('#custom_design_to').val())=='')
		{
			errors=1;
			$('#fromMsg').html('Please select start date OR  end date');
			$('#fromMsg').addClass('validation-advice');

		}

		if(errors==1)
		{
			return false;
		}
	});

	$('#contact-help').click(function(){
		$('#contact-form').show();
		$('#contact-help').hide();
	});

	$('#business_detail').submit(function(){
		$('#business_detail .error_msg').html('').removeClass('validation-advice');
		var errors=0;
		
		if($.trim($('#business_detail #company').val()) == '')
		{
			//$('#business_detail #company').css('border', 'solid 1px red');
			$('#business_detail #companyMsg').html('Please enter your company name');
			$('#business_detail #companyMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			$('#business_detail #company').css('border', '');
			var filter = /^[a-zA-Z0-9\s.,\'&]+$/;
			if(!filter.test($.trim($('#business_detail #company').val())))
			{
				errors=1;
				$('#business_detail #company .error-txt error-msg').html('Please enter a  valid company name');
				$('#business_detail #company .error-txt error-msg').addClass('validation-advice');
			}
		}

		if($.trim($('#business_detail #street').val()) == '')
		{
			$('#business_detail #streetMsg').html('Please enter your address');
			$('#business_detail #streetMsg').addClass('validation-advice');
			//$('#business_detail #street').css('border', 'solid 1px red');
			errors=1;
		}
		else
		{
			//$('#business_detail #street').css('border', '');
			//var filter = /^[A-Za-z0-9\s\'\-_,&]+$/;
			var filter= /^[A-Za-z0-9\s\'-_,&\/\/]+$/;
			if(!filter.test($.trim($('#business_detail #street').val())))
			{
				errors=1;
				$('#business_detail #streetMsg').html('Please enter a valid address');
				$('#business_detail #streetMsg').addClass('validation-advice');
			}
		}

		/*if($.trim($('#business_detail #street1').val()) == '')
		{
			//$('#business_detail #street1').css('border', 'solid 1px red');
			$('#business_detail #street1Msg').html('Please Enter Valid House Number');
			$('#business_detail #street1Msg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			//$('#business_detail #street1').css('border', '');
			//var filter = /^[A-Za-z0-9\s\'\-_,&]+$/;
			var filter= /^[A-Za-z0-9\s\'-_,&\/\/]+$/;
			if(!filter.test($.trim($('#business_detail #street1').val())))
			{
				errors=1;
				$('#business_detail #street1Msg').html('Please Enter Valid House Number');
				$('#business_detail #street1Msg').addClass('validation-advice');
			}
		}*/

		if($.trim($('#business_detail #city').val()) == '')
		{
			//$('#business_detail #city').css('border', 'solid 1px red');
			$('#business_detail #cityMsg').html('Please enter your city');
			$('#business_detail #cityMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			//$('#business_detail #city').css('border', '');
		}

		if($.trim($('#business_detail #state').val()) == '')
		{
			//$('#business_detail #state').css('border', 'solid 1px red');
			$('#business_detail #stateMsg').html('Please select your state');
			$('#business_detail #stateMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			//$('#business_detail #state').css('border', '');
		}

		if($.trim($('#business_detail #pincode').val()) == '')
		{
			//$('#business_detail #pincode').css('border', 'solid 1px red');
			$('#business_detail #pincodeMsg').html('Please enter your pincode');
			$('#business_detail #pincodeMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			//$('#business_detail #pincode').css('border', '');
			
			if($.trim($('#business_detail #pincode').val()).length != 6)
			{
				errors=1;
				$('#business_detail #pincodeMsg').html('Please enter a 6-digit valid pincode ');
				$('#business_detail #pincodeMsg').addClass('validation-advice');	
			}
		}

		if($.trim($('#business_detail #phone').val()) == '')
		{
			//skip telephone number mandatory validations 

			//$('#business_detail #phone').css('border', 'solid 1px red');
			//errors=1;
		}
		else
		{
			//$('#business_detail #phone').css('border', '');
			if($.trim($('#business_detail #phone').val()).length != 11)
			{
				errors=1;
				$('#business_detail #phoneMsg').html('Please enter a 11-digit valid landline number (e.g. 0222830XXXX)');
				$('#business_detail #phoneMsg').addClass('validation-advice');
			}
		}

		var category_id_select = 0;
		$('#business_detail .category_chk').each(function(ele){
			if($(this).is(":checked")) {
				category_id_select = parseInt($("#business_detail #" + this.id).val());
				//alert(category_id_select);
			}
		});

		if(category_id_select==0)
		{
			errors=1;
			$('#business_detail #categoriesMsg').html('Please select atleast one category');
			$('#business_detail #categoriesMsg').addClass('validation-advice');
			//$('#business_detail #categories').css('border', 'solid 1px red');
			//alert('Please select one of the meta category');
		}
		else
		{
			//$('#business_detail #categories').css('border', '');
		}

		if(errors==1)
		{
			return false;
		}
	});

	$('#bank_detail').submit(function(){
		$('.error_msg').html('').removeClass("validation-advice");
		var errors=0;

		if($.trim($('#payee_name').val()) == '')
		{
			$('#pnMsg').html('Please Enter Valid Beneficiary Name').addClass("validation-advice");
			errors=1;
		}
		else
		{
			/*var filter = /^[A-Za-z0-9\s.\']+$/;
			if(!filter.test($.trim($('#payee_name').val())))
			{
				errors=1;
				$('#pnMsg').html('Please Enter Valid Beneficiary Name').addClass("validation-advice");
			}*/
		}

		/*if($.trim($('#fname').val()) == '')
		{
			//$('#fname').css('border', 'solid 1px red');
			$('#fnameMsg').html('Please Enter Valid First Name').addClass("validation-advice");
			errors=1;
		}
		else
		{
			$('#fname').css('border', '');
			var filter = /^[A-Za-z\s\']+$/;
			if(!filter.test($.trim($('#fname').val())))
			{
				errors=1;
				$('#fnameMsg').html('Please Enter Valid First Name').addClass("validation-advice");
			}
		}

		if($.trim($('#lname').val()) == '')
		{
			$('#lnameMsg').html('Please Enter Valid Last Name').addClass("validation-advice");
			errors=1;
		}
		else
		{
			$('#lname').css('border', '');
			var filter = /^[A-Za-z\s\']+$/;
			if(!filter.test($.trim($('#lname').val())))
			{
				errors=1;
				$('#lnameMsg').html('Please Enter Valid Last Name').addClass("validation-advice");
			}
		}*/

		if($.trim($('#acc_no').val()) == '')
		{
			//$('#acc_no').css('border', 'solid 1px red');
			$('#accMsg').html('Please Enter Valid Bank Account Number').addClass("validation-advice");
			errors=1;
		}
		else
		{
			$('#acc_no').css('border', '');
			/*var filter = /^[A-Za-z0-9\s]+$/;
			if(!filter.test($.trim($('#acc_no').val())))
			{
				errors=1;
				$('#accMsg').html('Please Enter Valid Bank Account Number').addClass("validation-advice");
			}*/
		}

		if($.trim($('#ifsc').val()) == '')
		{
			//$('#ifsc').css('border', 'solid 1px red');
			$('#ifscMsg').html('Please Enter Valid IFSC Code').addClass("validation-advice");
			errors=1;
		}
		else
		{
			$('#ifsc').css('border', '');
			/*var filter = /^[A-Za-z0-9\s]+$/;
			if(!filter.test($.trim($('#ifsc').val())))
			{
				errors=1;
				$('#ifscMsg').html('Please Enter Valid IFSC Code').addClass("validation-advice");
			}*/
		}

		if(errors==1)
		{
			return false;
		}
	});

	$('#register_detail').submit(function(){
		$('#register_detail .error_msg').html('').removeClass('validation-advice');
		var errors=0;

		if($.trim($('#fname').val()) == '')
		{
			//$('#fname').css('border', 'solid 1px red');
			$('#fnameMsg').html('Please enter your first name (Alphabets only)').addClass('validation-advice');
			errors=1;
		}
		else
		{
			$('#fname').css('border', '');
			var filter = /^[A-Za-z\s\']+$/;
			if(!filter.test($.trim($('#fname').val())))
			{
				errors=1;
				$('#fnameMsg').html('Please enter your first name (Alphabets only)').addClass('validation-advice');
			}
		}

		if($.trim($('#lname').val()) == '')
		{
			//$('#lname').css('border', 'solid 1px red');
			$('#lnameMsg').html('Please enter your last name (Alphabets only)').addClass('validation-advice');
			errors=1;
		}
		else
		{
			$('#lname').css('border', '');
			var filter = /^[A-Za-z\s\']+$/;
			if(!filter.test($.trim($('#lname').val())))
			{
				errors=1;
				$('#lnameMsg').html('Please enter your last name (Alphabets only)').addClass('validation-advice');
			}
		}

		if($.trim($('#register_detail #email').val()) == '')
		{
			//$('#register_detail #email').css('border', 'solid 1px red');
			$('#register_detail #emailMsg').html('Please enter your email ID').addClass('validation-advice');
			errors=1;
		}
		else
		{
			$('#register_detail #email').css('border', '');
			//var filter = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9-]+\.[a-zA-Z]{2,4}(\.[a-zA-Z]{2,3})?(\.[a-zA-Z]{2,4})?$/i;
			var filter=/^[a-zA-Z0-9._-]+@([0-9a-z][0-9a-z.-]+\.)+[a-zA-Z]{2,4}$/i;
			if(!filter.test($.trim($('#register_detail #email').val())))
			{
				errors=1;
				$('#register_detail #emailMsg').html('Please enter a valid email ID').addClass('validation-advice');
			}
		}
                
                
               
                

		if($.trim($('#register_detail #password').val()) == '')
		{
			//$('#register_detail #password').css('border', 'solid 1px red');
			$('#register_detail #passwordMsg').html('Please enter a password').addClass('validation-advice');
			errors=1;
		}
		else
		{
			//$('#register_detail #password').css('border', '');
				if($('#register_detail #password').length > 0){
					if ( ($.trim($('#register_detail #password').val()).length < 6) || ($.trim($('#register_detail #password').val()).length > 20) )
					{
						errors=1;
						$('#register_detail #passwordMsg').html('Password should be in range of 6 to 20 characters.').addClass('validation-advice');
					}
				}
		}

		if($.trim($('#register_detail #rpassword').val()) == '')
		{
			//$('#register_detail #rpassword').css('border', 'solid 1px red');
			$('#register_detail #rpasswordMsg').html('Please confirm your password').addClass('validation-advice');
			errors=1;
		}
		else
		{
			$('#register_detail #rpassword').css('border', '');
			
			if($.trim($('#register_detail #rpassword').val()) != $.trim($('#register_detail #password').val()))
			{
				errors=1;
				$('#register_detail #rpasswordMsg').html('Your passwords don\'t match').addClass('validation-advice');
			}
		}

		if($.trim($('#register_detail #mobile').val()) == '')
		{
			//$('#register_detail #mobile').css('border', 'solid 1px red');
			$('#register_detail #mobileMsg').html('Please enter 10-digit mobile number (e.g. 9967XXXXXX)').addClass('validation-advice');
			errors=1;
		}
		else
		{
			//$('#register_detail #mobile').css('border', '');

			if($.trim($('#register_detail #mobile').val()).length != 10)
			{
				errors=1;
				$('#register_detail #mobileMsg').html('Please enter a valid 10-digit mobile number (e.g. 9967XXXXXX)').addClass('validation-advice');
			}

			var filter = /^[0-9]+$/;
			if(!filter.test($.trim($('#register_detail #mobile').val())))
			{
				errors=1;
				$('#register_detail #mobileMsg').html('Please Enter Valid Mobile Number').addClass('validation-advice');
			}
		}

		if(errors==1)
		{
			return false;
		}
	});

	$('#mobile_detail').submit(function(){
		var errors=0;
		$('#otpMsg').html('').removeClass('validation-advice');
		if($.trim($('#mobile_detail #mobile_code').val()) == '')
		{
			//$('#mobile_detail #mobile_code').css('border', 'solid 1px red');
			$('#otpMsg').html('Please enter a valid verification code').addClass('validation-advice');
			errors=1;
		}
		else
		{
			//$('#register_detail #mobile_code').css('border', '');
		}

		if(errors==1)
		{
			return false;
		}
	});

	$('#accept_detail').submit(function(){
		var errors=0;
		
		if($('#accept_check').is(":checked"))
		{
			$('#acceptMsg').hide();
		}
		else
		{
			$('#acceptMsg').show();
			errors=1;
		}
		
		if(errors==1)
		{
			return false;
		}
	});

	$("#city").autocomplete({
	    source: root_url+"/customer_account/suggest_city/",
	    minLength: 2,
	    appendTo: "#city_result", 
	    select: function( event, ui ) {
	      //log( ui.item ?"Selected: " + ui.item.value + " aka " + ui.item.id :"Nothing selected, input was " + this.value );
	    },
	    change: function( event, ui ) {
	    	$("#city").removeClass('error-border');
	    }
	});

	$('#sendOTP').click(function(){
		var url = root_url + '/merchant/sendOtpCode';

		$.ajax({
			type: 'POST',
			url: url,
			beforeSend: function() {
				//alert('Sending the code');	
			},
			success: function(resulthtml)
			{
				//alert('Code has sent on your mobile');
				$("#before-resend").hide();
				$("#after-resend").show();
                                $('#success_otpmsg').css('display','block');
			},
			error: function(message)
			{
				alert('error. Please Resend the code.');
			}
		});
		return false;
	});

	$('#resendAL').click(function(){
		var url = root_url + '/merchant/sendActivationlink';

		$.ajax({
			type: 'POST',
			url: url,
			beforeSend: function() {
				//alert('Please Wait .... ');	
			},
			success: function(resulthtml)
			{
				alert(resulthtml);
				//alert('Code has sent on your mobile');
				//$("#before-resend").hide();
				//$("#after-resend").show();
			},
			error: function(message)
			{
				alert('error. Please Resend the code.');
			}
		});
		return false;
	});

	$("#to-before-resend").on('click', function(){
		$("#after-resend").hide();
		var text = '<p>Thank you for registering your mobile phone number </p><h2  class="mobile_number"><strong>'+otp_mobile_number+'</strong></h2><p>We have SMSed you a verification code (from <strong>LM-PPRFRY</strong>)</p><br />';
		$("#before-resend").html(text);
		$("#before-resend").show();
	});
	
	
	/*$("#quick_view").on("click", '.cross', function(event){
		alert('cross');
		$('.transparent_bg').hide();
		//$('.quick_look').html('');		
	});*/

	$('.edit_address').click(function(){
		var id=this.id;
		$('.edit_info').html('');
		
		if(id > 0)
		{
			var url = root_url + '/merchant/editAddress';

			$.ajax({
				type: 'POST',
				url: url,
				data:{address_id:id},
				async: false,
				beforeSend: function() {
					//console.log('before send');
				},
				success: function(resulthtml)
				{
					$('.edit_info').html(resulthtml);
					$('#edit_tab').show();
				},
				error: function(message)
				{
					alert('Please Try later!');
				}
			});
			
		}
		return false;
		
	});

	$("#edit_city").on("focus", function() {
		$('.ui-helper-hidden-accessible').hide();
		$(this).autocomplete({
			source: root_url+"/customer_account/suggest_city/",
			minLength: 2,
			appendTo: "#edit_city_result", 
			select: function( event, ui ) {
			 //log( ui.item ?"Selected: " + ui.item.value + " aka " + ui.item.id :"Nothing selected, input was " + this.value );
			},
			change: function( event, ui ) {
	    		$("#edit_city").removeClass('error-border');
			}
		});
	});

	$('#edit_tab').on('click','#editaddressSubmit',function(){
		$('#edit_address .error_msg').html('').removeClass('validation-advice');
		var errors=0;

		if($.trim($('#edittextAddress').val()) == '')
		{
			$('#editaddressMsg').html('Please enter your address');
			$('#editaddressMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			var filter= /^[A-Za-z0-9\s\'-_,#&\/\/]+$/;
			if(!filter.test($.trim($('#edittextAddress').val())))
			{
				errors=1;
				$('#editaddressMsg').html('Please enter a valid address');
				$('#editaddressMsg').addClass('validation-advice');
			}
		}

		if($.trim($('#edit_city').val()) == '')
		{
			$('#editcityMsg').html('Please enter your city');
			$('#editcityMsg').addClass('validation-advice');
			errors=1;
		}
	
		if($.trim($('#edittextState').val()) == '')
		{
			//$('#state').css('border', 'solid 1px red');
			$('#editstateMsg').html('Please select your state');
			$('#editstateMsg').addClass('validation-advice');
			errors=1;
		}

		if($.trim($('#edittextPincode').val()) == '')
		{
			$('#editpincodeMsg').html('Please enter your pincode');
			$('#editpincodeMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			if($.trim($('#edittextPincode').val()).length != 6)
			{
				errors=1;
				$('#editpincodeMsg').html('Please enter a 6-digit valid pincode ');
				$('#editpincodeMsg').addClass('validation-advice');	
			}
		}

		if($.trim($('#edittextPhone').val()) == '')
		{
			$('#editphoneMsg').html('Please enter your phone number');
			$('#editphoneMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			if($.trim($('#edittextPhone').val()).length != 11)
			{
				errors=1;
				$('#editphoneMsg').html('Please enter a 11-digit valid landline number (e.g. 0222830XXXX)');
				$('#editphoneMsg').addClass('validation-advice');
			}

			var filter= /^[0-9]+$/;
			if(!filter.test($.trim($('#edittextPhone').val())))
			{
				errors=1;
				$('#editphoneMsg').html('Only Digits are allowed for Phone Number');
				$('#editphoneMsg').addClass('validation-advice');
			}
		}
		

		//console.log(errors);
		if(errors==0)
		{
			var form_data=$("#edit_address").serialize();
			console.log(form_data);
			var url = root_url + '/merchant/postAddress';
			$.ajax({
				type: 'POST',
				url: url,
				data:{data:form_data},
				async: false,
				beforeSend: function() {
					
				},
				success: function(resulthtml)
				{
					if(resulthtml=='success')
					{
						window.location.reload();
					}
					else
					{
						$('#edit_header_error').html(resulthtml);
					}
					//alert('in success');				
					//$("#div-loader-wait").hide();
				},
				error: function(message)
				{
					alert('error');
				}
			});
		}
		return false;
	});

	$('#account_submit').click(function(){
		$('#account_edit .error_msg').html('').removeClass('validation-advice');
		var errors=0;

		if($.trim($('#account_edit #address').val()) == '')
		{
			$('#account_edit #addressMsg').html('Please enter your address');
			$('#account_edit #addressMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			var filter= /^[A-Za-z0-9\s\'-_,#&\/\/]+$/;
			if(!filter.test($.trim($('#account_edit #address').val())))
			{
				errors=1;
				$('#account_edit #addressMsg').html('Please enter a valid address');
				$('#account_edit #addressMsg').addClass('validation-advice');
			}
		}

		
		if($.trim($('#account_edit #city').val()) == '')
		{
			$('#account_edit #cityMsg').html('Please enter your city');
			$('#account_edit #cityMsg').addClass('validation-advice');
			errors=1;
		}
		

		if($.trim($('#account_edit #state').val()) == '')
		{
			$('#account_edit #stateMsg').html('Please select your state');
			$('#account_edit #stateMsg').addClass('validation-advice');
			errors=1;
		}
		

		if($.trim($('#account_edit #pincode').val()) == '')
		{
			$('#account_edit #pincodeMsg').html('Please enter your pincode');
			$('#account_edit #pincodeMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			var filter= /^[0-9]+$/;
			if(!filter.test($.trim($('#account_edit #pincode').val())))
			{
				errors=1;
				$('#account_edit #pincodeMsg').html('Only Digits are allowed for Pincode');
				$('#account_edit #pincodeMsg').addClass('validation-advice');
			}
			
			if($.trim($('#account_edit #pincode').val()).length != 6)
			{
				errors=1;
				$('#account_edit #pincodeMsg').html('Please enter a 6-digit valid pincode ');
				$('#account_edit #pincodeMsg').addClass('validation-advice');	
			}
		}

		if($.trim($('#account_edit #phone').val()) == '')
		{
			//skip telephone number mandatory validations 
		}
		else
		{
			if($.trim($('#account_edit #phone').val()).length != 11)
			{
				errors=1;
				$('#account_edit #phoneMsg').html('Please enter a 11-digit valid landline number (e.g. 0222830XXXX)');
				$('#account_edit #phoneMsg').addClass('validation-advice');
			}
		}

		if($.trim($('#account_edit #mobile').val()) == '')
		{
			$('#account_edit #mobileMsg').html('Please enter your pincode');
			$('#account_edit #mobileMsg').addClass('validation-advice');
			errors=1;
		}
		else
		{
			var filter= /^[0-9]+$/;
			if(!filter.test($.trim($('#account_edit #mobile').val())))
			{
				errors=1;
				$('#account_edit #mobileMsg').html('Only Digits are allowed for Mobile');
				$('#account_edit #mobileMsg').addClass('validation-advice');
			}

			if($.trim($('#account_edit #mobile').val()).length != 10)
			{
				errors=1;
				$('#account_edit #mobileMsg').html('Please enter a 10-digit valid mobile number');
				$('#account_edit #mobileMsg').addClass('validation-advice');
			}
		}

		if(errors==1)
		{
			return false;
		}
	});


	//work for change password start
	$('#cp_submit').click(function(){
		$('.error_msg').html('').removeClass('validation-advice');
		var errors=0;

		if($.trim($('#cpassword').val()) == '')
		{
			//$('#register_detail #password').css('border', 'solid 1px red');
			$('#cpasswordMsg').html('Please enter current password').addClass('validation-advice');
			errors=1;
		}

		if($.trim($('#npassword').val()) == '')
		{
			$('#npasswordMsg').html('Please enter new password').addClass('validation-advice');
			errors=1;
		}
		else
		{
			if($.trim($('#npassword').val()).length < 6)
			{
				errors=1;
				$('#npasswordMsg').html('Please enter atleast 6 characters for your password').addClass('validation-advice');
			}
		}

		if($.trim($('#rpassword').val()) == '')
		{
			$('#rpasswordMsg').html('Please confirm your password').addClass('validation-advice');
			errors=1;
		}
		else
		{
			if($.trim($('#rpassword').val()) != $.trim($('#npassword').val()))
			{
				errors=1;
				$('#rpasswordMsg').html('Your passwords doesn\'t match').addClass('validation-advice');
			}
		}

		if(errors==1)
		{
			return false;
		}
	});
	//work for change password end

	$('.prc_check').on('change',function(){
		var checked = $(this).prop('checked');
		var value= $(this).val();

		$('.prc_input_'+value).prop('disabled', !checked);
	});

	$('#comission_prc').click(function(){
		//alert('here');
		var form_data=$("#prc_comission_form").serialize();
		//alert(form_data);
		//$("#div-loader-wait").show();
		var url = root_url + '/merchant_listing/postcomission';
		$.ajax({
			type: 'POST',
			url: url,
			data:{data:form_data},
			async: false,
			beforeSend: function() {
				
			},
			success: function(resulthtml)
			{
				alert(resulthtml);
				//alert('in success');				
				//$("#div-loader-wait").hide();
			},
			error: function(message)
			{
				alert('error');
			}
		});
		return false;
	});
	
	$('#prc_pinc').click(function(){		
		var form_data=$("#prc_comission_form").serialize();		
		//$("#div-loader-wait").show();
		var url = root_url + '/merchant_listing/post_prc_pincode';
		$.ajax({
			type: 'POST',
			url: url,
			data:form_data,
			async: false,
			beforeSend: function() {
				
			},
			success: function(resulthtml)
			{
				//alert(resulthtml);
				if(resulthtml == 'success'){
					alert('data saved succesfully');
				}else{
					//alert('data update failed');
					$('#prc_msg').html(resulthtml);
				}
				//alert('in success');				
				//$("#div-loader-wait").hide();
			},
			error: function(message)
			{
				alert('error');
			}
		});
		return false;
	});
	
	$('#prc_pincode').click(function(){
		//alert('here');
		var form_data=$("#prc_comission_form").serialize();		
		//$("#div-loader-wait").show();
		var url = root_url + '/merchant_listing/post_prc_pincode';
		$.ajax({
			type: 'POST',
			url: url,
			data:{data:form_data},
			async: false,
			beforeSend: function() {
				
			},
			success: function(resulthtml)
			{
				//alert(resulthtml);
				if(resulthtml == 'success'){
					alert('data saved succesfully');
				}else{
					alert('data update failed');
				}
				//alert('in success');				
				//$("#div-loader-wait").hide();
			},
			error: function(message)
			{
				alert('error');
			}
		});
		return false;
	});

	$("#merchantLogin").click(function() {
		$("#loginBox").fadeIn(50);
                $('#merchant_register_login').val('merchant_register_login');
	});

	$('.order_paging').click(function(){
		var value=$(this).attr('rel');
		$("#pageview").val(value);
		$("#merchant_order").submit();
	});

	$('.product_paging').click(function(){
		//alert('hi');
		var value=$(this).attr('rel');
		$("#pageview").val(value);
		$("#merchant_products").submit();
	});	

	$('.item_prod_detail').click(function(){
		var val= $(this).attr('rel');
		alert(val);
	});


	$('table#prod_data').on('click','.liveList',function(){
		var product_id=this.id;

		//append tr with td  loader after configurable products tr
		$('.liveList'+product_id).after('<tr id="child'+product_id+'"><td colspan=11 style="text-align:center;"><image src="'+root_url+'/media/image/opc-ajax-loader.gif"/><br /> Getting Associated Products<\/td></tr>');

		path=root_url+'/merchant/ajaxChildProducts';

		$.ajax({ 
			url: path,
			data:{product_id:product_id},
			dataType:"json",
			type: "POST",
			success: function(data){	
				if(data=='error')
				{	
					//if error, remove tr which was appended 
					$('#child'+product_id).remove();
				}
				else
				{
					$('#child'+product_id).html(data);
					$('#'+product_id).removeClass('liveList').addClass('ajaxList');
				}
        	},
			error: function(data){
				//if error, remove tr which was appended 
				$('#child'+product_id).remove();
        	}
		});
	});

	$('table#prod_data').on('click','.ajaxList',function(){
		var product_id=this.id;
		$('#child'+product_id).toggle();
	});

	
	$('.check_data').click(function() {
		$('form').ajaxForm({
			beforeSend: function() {
				status.empty();
				body = '';
				$("#check-data").attr("disabled", true);
				$("#upload_type").attr("disabled", true);
				timer = setTimeout('getProgress()',5000);
				$("#check-data").val("Please wait...");
			},
			success: function() {
				$("#bulk").empty();
				clearTimeout(timer);
			},
			complete: function(xhr) {            
				//status.html(xhr.responseText);
				status.empty();
				clearTimeout(timer);
				var res = $.parseJSON(xhr.responseText);
				if(res.error) {
					status.append("Please rectify the below mentioned errors.<br /></br />");
					//for(var i in res.error) {
					scan(res.error);	
					status.append( body +"<br />");
					//}
					$("#check-data").attr("disabled", false);
					$("#upload_type").attr("disabled", false);
					$("#check-data").val("Save Data");
					hit=0;
				}
				else if(res.success){
					for(var i in res.success) {
						status.append(res.success[i]+"<br />");
					}
					hit=1;
					$("#check-data").attr("disabled", false);
					$("#upload_type").attr("disabled", false);
					$("#check-data").val("Save Data");
					//$("#check-data").hide();
					//$("#save-data").show();
				}
				else {
					alert("ZOIKS");
				}
			},
			error:function(t) {
				console.log(t);
			}
		});
	});

	$('.bulkinvoice_form').bind('click',function() {
		var val = $("#check-data").val();
		//alert(val);
		if(val=="Submit")
		{
			$('#csvform').submit();
			return false;
		}
		else if(val=="Validate CSV")
		{
			$('form').ajaxForm({
				beforeSend: function() {
					status.empty();
					body = '';
					$("#check-data").attr("disabled", true);
					$("#upload_type").attr("disabled", true);
					//timer = setTimeout('getProgress()',5000);
					$("#check-data").val("Please wait...");
				},
				success: function() {
					$("#bulk").empty();
					
				},
				complete: function(xhr) {            
					//status.html(xhr.responseText);
					status.empty();
					var res = $.parseJSON(xhr.responseText);
					if(res.error) {
						status.append("Please rectify the below mentioned errors.<br /></br />");
						//for(var i in res.error) {
						scan(res.error);	
						status.append( body +"<br />");
						//}
						$("#check-data").attr("disabled", false);
						$("#upload_type").attr("disabled", false);
						$("#check-data").val("Validate CSV");
						hit=0;
					}
					else if(res.success){
						for(var i in res.success) {
							status.append(res.success[i]+"<br />");
						}
						hit=1;
						$("#check-data").attr("disabled", false);
						$("#upload_type").attr("disabled", false);
						$("#check-data").val("Submit");
						//$('.bulkinvoice_form').unbind('click');
						$('form').unbind('submit').find('input:submit,input:image,button:submit').unbind('click'); 
						//$("#check-data").removeClass('bulkinvoice_form');
						//$("#save-data").show();
					}
					else {
						alert("ZOIKS");
					}
				},
				error:function(t) {
					console.log(t);
				}
			});
		}
	});

	//supplier add edit form validation start
	$('#reset').click(function(){
		$('.err').html('');
	});

	$("#myform").submit(function()
	{
		var pro = true;
		var err = '';
		$("#div-error-messages").html('');
		$("#div-error-messages").hide();
		$('.required').each(function(){
			if(empty($.trim($(this).val()))) {
				$(this).addClass('error-border');
				pro = false;
			} else if(this.id == 'email' || this.id == 'customer_email')
                                {
				if(validateEmail($(this).val()) == false) {
					$(this).addClass('error-border');
					pro = false;
					err += $(this).val() + " is not a valid email format.<br />";
				}
			} else if(this.id == 'pincode') {
				if(document.getElementById("state").value!='Other')
				{
					if($(this).val().length!=6) {
						$(this).addClass('error-border');
						pro = false;
						err += "Pincode needs to be exactly 6 digits.<br />";
					} else {
						var filter = /^[0-9]+$/;
						if(!filter.test($(this).val())) {
							$(this).addClass('error-border');
							pro = false;
							err += "Pincode needs to be numeric only.<br />";
						}
					}
			 }
			} else if(this.id == 'customer_mobile') {
				if($(this).val().length!=10) {
					$(this).addClass('error-border');
					pro = false;
					err += "Customer Mobile needs to be exactly 10 digits.<br />";
				} else {
					var filter = /^[0-9]+$/;
					if(!filter.test($(this).val())) {
						$(this).addClass('error-border');
						pro = false;
						err += "Customer Mobile needs to be numeric only.<br />";
					}
				}
			} else if(this.id == 'customer_password') {
				if($(this).val().length < 6) {
					$(this).addClass('error-border');
					pro = false;
					err += "Customer Password cannot be less than 6 charachters.<br />";
				}
			} else if(this.id == 'customer_confirm_password') {
				if($(this).val() != $('#customer_password').val()) {
					$(this).addClass('error-border');
					pro = false;
					err += "Customer Passwords do not match.<br />";
				}
			}
                         else if(this.id == 'stock_inti_email' || this.id == 'customer_email') {
				if(validateEmail($(this).val()) == false) {
					$(this).addClass('error-border');
					pro = false;
					err += $(this).val() + " is not a valid email format.<br />";
				}
			} 

		});
		if(pro === false) {
			$("#div-error-messages").html("Please rectify the below issues.<br />" + err );
			$("#div-error-messages").show();
		}
		return pro;
		//$('.err').html('');
		/*var supplier_name = $.trim($("#supplier_name").val());
		var address=$.trim($("#address_line1").val());
		var email=$.trim($("#email").val());
		var add_email=$.trim($("#add_email").val());
		var city=$.trim($("#city").val());
		var pincode=$.trim($("#pincode").val());
		var area_code=$.trim($("#area_code").val());
		var phone=$.trim($("#phone").val());
		var contact_person=$.trim($("#contact_person").val());
		var buyerid=$.trim($("#buyerid").val());
		var warehouse=$.trim($("#warehouse").val());
		var customer_id=$.trim($("#customer_id").val());
		var supplier_id=$.trim($("#supplier_id").val());
		//alert(customer_id);
		//alert(supplier_id);
		//alert('here'); return false;
		//alert(buyerid)

		var err=false;
			if(supplier_name == "")
			{
				err=true;
				$("#nameMsg").html('This Is Required Field');
			}
			else
			{
				var filter = /^[a-zA-Z0-9\s.,\'&]+$/;
				if(!filter.test(supplier_name))
				{
					err=true;
					$("#nameMsg").html('Only Characters and Digits are allowed for Company name.');
				}
			}
			
			if(buyerid == "")
			{
				err=true;
				$("#buyerMsg").html('This Is Required Field');
			}
			
			if(address == "")
			{
				err=true;
				$("#addressMsg").html('This Is Required Field');
			}
			if(email == "")
			{
				err=true;
				$("#emailMsg").html('This Is Required Field');
			}
			else if(!validateEmail(email))
			{
				err=true;
				$("#emailMsg").html('Enter Valid Email Address');
			}

			if(add_email!="")
			{
				if(!validateEmail(add_email))
				{
					err=true;
					$("#AddEmailMsg").html('Enter Valid Email Address');
				}
			}

			if(city == "")
			{
				err=true;
				$("#cityMsg").html('This Is Required Field');
			}
			
			if(pincode == "")
			{
				err=true;
				$("#codeMsg").html('This Is Required Field');
			}
			else if (pincode.length!=6)
			{
				err=true;
				$("#codeMsg").html('Enter 6 Digit pincode');
			}

			if(area_code == "")
			{
				err=true;
				$("#area_codeMsg").html('This Is Required Field');
			}
			
			if(phone == "")
			{
				err=true;
				$("#phoneMsg").html('This Is Required Field');
			}

			if(contact_person == "")
			{
				err=true;
				$("#cpMsg").html('This Is Required Field');
			}
			
			if(warehouse == "select")
			{
				err=true;
				$("#warehouseMsg").html('This Is Required Field');
			}

			if(supplier_id==0 && customer_id==0)
			{
				var customer_fname=$.trim($('#customer_fname').val());
				var customer_lname=$.trim($('#customer_lname').val());
				var customer_email=$.trim($('#customer_email').val());
				var customer_mobile=$.trim($('#customer_mobile').val());
				var customer_password=$.trim($('#customer_password').val());
				var customer_confirm_password=$.trim($('#customer_confirm_password').val());
				
				if(customer_fname=='')
				{
					err=true;
					$("#fnameMsg").html('First name should not be blank');
				}
				else
				{
					var filter = /^[A-Za-z\s\']+$/;
					if(!filter.test(customer_fname))
					{
						err=true;
						$("#fnameMsg").html('Only Characters are allowed first name');
					}
				}

				if(customer_lname=='')
				{
					err=true;
					$("#lnameMsg").html('Last name should not be blank');
				}
				else
				{
					var filter = /^[A-Za-z\s\']+$/;
					if(!filter.test(customer_lname))
					{
						err=true;
						$("#lnameMsg").html('Only Characters are allowed last name');
					}
				}

				if(customer_email=='')
				{
					err=true;
					$("#ceMsg").html('Email Id should not be blank');
				}
				else if(!validateEmail(customer_email))
				{
					err=true;
					$("#ceMsg").html('Enter Valid email Id');
				}

				if(customer_mobile == '')
				{
					err=true;
					$("#cmMsg").html('Mobile number should not be blank');
				}
				else
				{
					if(customer_mobile.length != 10)
					{
						err=true;
						$("#cmMsg").html('Please enter a valid 10-digit mobile number (e.g. 9967XXXXXX)');
					}

					var filter = /^[0-9]+$/;
					if(!filter.test(customer_mobile))
					{
						err=true;
						$("#cmMsg").html('Please enter a valid 10-digit mobile number (e.g. 9967XXXXXX)');
					}
				}

				if(customer_password == '')
				{
					err=true;
					$("#pMsg").html('Password should not be blank');
				}
				else if(customer_password.length < 6)
				{
					err=true;
					$("#pMsg").html('Please enter atleast 6 characters for password');
				}

				if(customer_confirm_password == '')
				{
					err=true;
					$("#cnpMsg").html('Please confirm the password');
				}
				else if(customer_password!=customer_confirm_password)
				{
					err=true;
					$("#cnpMsg").html('passwords don\'t match');
				}
			}
			
			if(err==true)
			{
				return false;
			}*/
	});
	//supplier add edit form validation end   

	//POD upload code start
	$('.pod_upload').click(function(){
		var order_detail=$(this).attr("rel").split("__");
		$('#pod_entity_id').val(order_detail[0]);
		$('#pod_item_id').val(order_detail[1]);
		$('#pod_item_sku').val(order_detail[2]);
		$("#pod_upload_box").fadeIn(50); 
	});

	$('.pod_form_submit').bind('click',function() {
		var val = $("#check-data").val();

		if(val=="Submit")
		{
			
			$('form').ajaxForm({
				beforeSend: function() {
					status.empty();
					body = '';
					$("#check-data").attr("disabled", true);
					$("#check-data").val("Please wait...");
				},
				success: function() {
					$("#bulk").empty();
				},
				complete: function(xhr) {            
					status.empty();
					var res = $.parseJSON(xhr.responseText);
					if(res.error) {
						status.append("Please rectify the below mentioned errors.<br /></br />");
						scan(res.error);	
						status.append( body +"<br />");
						
						$("#check-data").attr("disabled", false);
						$("#check-data").val("Submit");
						hit=0;
					}
					else if(res.success){
						for(var i in res.success) {
							status.append(res.success[i]+"<br />");
						}
						
						$("#check-data").attr("disabled", false);
						$("#check-data").val("Submit");
						$('form').unbind('submit').find('input:submit,input:image,button:submit').unbind('click'); 
						window.setTimeout(function(){location.reload()},2000);
					}
					else {
						alert("Error");
					}
				},
				error:function(t) {
					console.log(t);
				}
			});
		}
	});

	$('.view_pod').click(function(){
		var pod_id=$(this).attr('rel');
		if(pod_id > 0)
		{
			path=root_url+'/merchant/podImage/'+pod_id;

			$.ajax({ 
				url: path,
				//data:{product_id:product_id},
				dataType:"html",
				type: "POST",
				success: function(data){
					$('#pod_image_div').html(data);
					$('#pod_view_box').fadeIn(50);
				},
				error: function(data){
					console.log('in error');
				}
			});
		}
	});
	
	
	
	$("#reset").click(function(){
		
		
			$('.checkdropship').hide();
		
		
	}); 
	
	//POD upload code end
});

if ($(".iframe").is('*') ) {
$('.iframe').fancybox({
'width': '1200px',
'height': '2800px',
'autoDimensions' : true,
'autoScale': true,
'transitionIn': 'fade',
'transitionOut': 'fade',
'type': 'iframe',
//'href': 'http://www.example.com'
});
} 
if(document.getElementById("state").value!='Other')
{
	$("#pincode").keypress(function(event)
		{
				return numeric(event);
		});
}

$("#phone").keypress(function(event)
{
	return numeric(event);
});

function setSelected(id)
{
	//alert(id);
	var checked=$('#'+id).is(":checked");
	if(checked)
	{
		$('#'+id+'_label').addClass('selected');
	}
	else
	{
		$('#'+id+'_label').removeClass('selected');
	}
}

function numeric(evt)
 {
        var charCode = (evt.which) ? evt.which : event.keyCode;
        if (charCode == 8 || charCode == 43 || charCode == 13 || ( charCode>=48 && charCode<=57)) {
        //if (charCode == 8 || charCode==39 || charCode==95 || (charCode>=65 && charCode<=90) || (charCode>=97 && charCode<=122)) {
        return true;
        }
        else {
            return false;
        }
}

function validateEmail(email) {
  var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
  if( !emailReg.test( email ) ) {
    return false;
  } else {
    return true;
  }
}

function quick_view(id,term)

	{		
		//$('#load-quick-'+id).show();
		//$('#load-quick-a-'+id).hide();
		$.ajaxSetup({cache:true});
		if(id > 0){
			$.ajax({
				//url:root_url+'/merchant/livelistings/'+id,
				url:root_url+'/merchant/livelistings/',
				success:function(data){
					$('#quick_view').show();
					$('.quick_look').html(data);
					//$('#load-quick-'+id).hide();
					//$('#load-quick-a-'+id).show();
				},
                cache: true,
				error:function(xhr, error){
					$('#quick_view').show();				
					$('.quick_look').html('Please Try Later');
					//$('#load-quick-'+id).hide();
					//$('#load-quick-a-'+id).show();
				}
			});
		}
	}

	function scan(obj)
	{
		var k;
		if (obj instanceof Object) 
		{
			for (k in obj){
            if (obj.hasOwnProperty(k))
			{
                if(k instanceof String) 
				{
                   body += 'scanning property ' + k + '<br /> ';
                }
                scan( obj[k] );  
            }
        }
		}
		else 
		{
			body += ' ' + obj + '<br/>';
		};
	};
	
/**
 * Marketplace + Supplier  = Pure Marketplace
 * Marketplace + (Prakruti or Plaza) = On Demand
 * Warehouse + (Prakruti or Plaza) = Warehouse
 */
$('#td-type_of_stock').on('change', '#type_of_stock', function(){
	var options = '';
	$('#seller').html('');
	$('#span-seller-output').html('');
	if($.trim($(this).val()) == '138') {//Marketplace
		options += '<option value="">Please Select</option>';
	        options += '<option value="'+seller_option[0].id+'">'+seller_option[0].name+'</option>';
		
	} else if($.trim($(this).val()) == '139') {//Warehouse
		options += '<option value="">Please Select</option>';
		$.each(seller_option, function(index, value){
                    if(value.id != 1){
                        options += '<option value="'+value.id+'">'+value.name+'</option>';
                    }
                });
		type = true;
		toggleCustomer(true);
	}
	$('#seller').html(options);
});

function toggleCustomer(type){
	$('#table-customer-information :input').each(function(){
		$(this).attr('disabled', type);
		$(this).removeClass('error-border');
		if(type === false) {
			$(this).addClass('required');
		} else {
			$(this).removeClass('required');
		}
	});
}

function empty (mixed_var) {
	var undef, key, i, len;
	//var emptyValues = [undef, null, false, 0, "", "0"];
	var emptyValues = [undef, null, false, ""];
	
	for (i = 0, len = emptyValues.length; i < len; i++) {
		if (mixed_var === emptyValues[i]) {
			return true;
	    }
	}

	if (typeof mixed_var === "object") {
		for (key in mixed_var) {
	      // TODO: should we check for own properties only?
	      //if (mixed_var.hasOwnProperty(key)) {
	      return false;
	      //}
	    }
	    return true;
	}

	return false;
}

function showSelectedrecords(val)
{
	$('#selectedMsg').hide();
	if(val > 0)
	{
		if(val==1)
		{
			var order_item_id=0;
			$('.order_item:checked').each(function() {
				order_item_id = order_item_id + 1;
			});

			if(order_item_id > 0)
			{
				$('#countSel').text(order_item_id);
				$('#selectedMsg').show();

			}
		}

		if(val==3)
		{
			var order_item_id=0;
			$('.order_item:checked').each(function() {
				order_item_id = order_item_id + 1;
			});

			if(order_item_id > 0)
			{
				$('#countSel').text('All');
				$('#selectedMsg').show();

			}
		}
	}
	
}

function showother()
{
	
	if(document.getElementById("state").value=='Other')
	{
		$('#other_show').css('display','');
		$('#other').addClass('required');
		
	}
	else
	{
		$('#other_show').css('display','none');
		$('#other').removeClass('required');
		$('#other').removeClass('error-border');
		$('#pincode').removeClass('required');
		$('#pincode').removeClass('error-border');
		document.getElementById("other").value="";
		
	}
}

function showhidecourier()
{
	if(document.getElementById("dropship").value==1)
	{
		$('.checkdropship').css('display','');
		$('#list_of_courier').addClass('required');
		$('#pod_acceptance').addClass('required');
		
	}
	else
	{
		$('.checkdropship').css('display','none');
		$('#list_of_courier').removeClass('required');
		$('#pod_acceptance').removeClass('required');
		document.getElementById("pod_acceptance").value="";
		document.getElementById("list_of_courier").value="";
	}
}